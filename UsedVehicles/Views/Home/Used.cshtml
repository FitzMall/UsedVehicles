@model UsedVehicles.Models.UsedVehicleModel

@{
    ViewBag.Title = "Fitzmall Used Vehicles";

    System.Globalization.NumberFormatInfo nfi = new System.Globalization.CultureInfo("en-US", false).NumberFormat;
    nfi.CurrencyDecimalDigits = 0;
    nfi.PercentDecimalDigits = 1;
    nfi.PercentPositivePattern = 1;

    var applicationPath = Request.ApplicationPath;

    if (applicationPath == "/")
    {
        applicationPath = "";
    }

    var titleStatus = UsedVehicles.Business.SqlQueries.GetAllTitleStatus();


}


@section CSS
{

    <script src="~/Scripts/jquery-ui.js"></script>
    <link href="~/Scripts/jquery-ui.css" rel="stylesheet" />
}
<style type="text/css">
    .nav-tabs li.active a, .nav-tabs li.active a:hover, .nav-tabs li.active a:focus {
        color: #ffedea;
        cursor: default;
        background-color: #428bca;
        border: 1px solid #dddddd;
        border-bottom-color: transparent;
    }

    .nav-tabs li a {
        border: 1px solid #dddddd;
        padding: 10px 10px;
    }

    .container {
        max-width: 100%;
    }

    .input-radio {
        margin-left: 25px;
    }
</style>

<div class="jumbotron">
    <h1>Fitzmall Used Vehicles over 90 Days</h1>
    <div class="row">
        <div class="col-sm-9">
            <h3>Select a Date:</h3>
        </div>
    </div>
    @using (Html.BeginForm())
    {
        <div class="row">
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-sm-2">
                        @Html.DropDownListFor(n => n.MonthId, new SelectList(UsedVehicles.Business.Enums.Months, "MonthId", "Name"), new { @class = "form-control form-inline" })
                    </div>
                    <div class="col-sm-2">
                        @Html.DropDownListFor(n => n.YearId, new SelectList(UsedVehicles.Business.Enums.Years, "YearId", "Name"), new { @class = "form-control form-inline" })
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        @Html.RadioButtonFor(n => n.ReportFilter, "ALL", new { @class = "input-radio" }) All
                        @Html.RadioButtonFor(n => n.ReportFilter, "CPO", new { @style = "margin-left:25px;" }) CPO
                        @Html.RadioButtonFor(n => n.ReportFilter, "NEXTCAR", new { @style = "margin-left:25px;" }) Nextcar
                        @Html.RadioButtonFor(n => n.ReportFilter, "HANDYMAN", new { @style = "margin-left:25px;" }) Handyman
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-9">
                        <button class="btn btn-primary" id="SubmitButton" type="submit" value="submit" name="Submit">Submit</button>
                    </div>
                </div>
            </div>
        </div>

    }
</div>
<div class="row" style="margin-top:10px;">
    <div class="col-md-12">
        <h2>Used Vehicles for @Model.MonthId/@Model.YearId</h2>
        @{
            decimal ListAmountTotal = 0;
            decimal CostAmountTotal = 0;
            decimal NewListAmountTotal = 0;
            decimal DiffToMarketAmountTotal = 0;

            int SoldCount = 0;
            decimal SoldAmountTotal = 0;
            decimal VehicleProfitTotal = 0;

            int DaysTotal = 0;
            int VehicleCount = 0;

        }

    </div>

</div>

@if (Model.UsedVehicles != null)
{
    var locations = Model.AllUsedVehicles.Select(x => x.Location).Distinct();
    var reportDate = new DateTime(Model.YearId, Model.MonthId, 1);

    <div class="row">
        <div class="col-md-12">
            <ul class="nav nav-tabs" id="myTab" role="tablist" style="font-size: 12px;">
                <li class="nav-item active">
                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">90 Day Summary</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="inventory-tab" data-toggle="tab" href="#inventory" role="tab" aria-controls="inventory" aria-selected="true">Inv Summary</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="status8-tab" data-toggle="tab" href="#status8" role="tab" aria-controls="status8" aria-selected="true">Status 8</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="status9-tab" data-toggle="tab" href="#status9" role="tab" aria-controls="status9" aria-selected="true">Status 9</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="status3-tab" data-toggle="tab" href="#status3" role="tab" aria-controls="status3" aria-selected="true">Status 3</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="status5-tab" data-toggle="tab" href="#status5" role="tab" aria-controls="status5" aria-selected="true">Status 5</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="status21-tab" data-toggle="tab" href="#status21" role="tab" aria-controls="status21" aria-selected="true">Status 21</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="status14-tab" data-toggle="tab" href="#status14" role="tab" aria-controls="status14" aria-selected="true">Status 14</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="status15-tab" data-toggle="tab" href="#status15" role="tab" aria-controls="status15" aria-selected="true">Status 15</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="status20-tab" data-toggle="tab" href="#status20" role="tab" aria-controls="status20" aria-selected="true">Status 20</a>
                </li>                
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade active in" id="home" role="tabpanel" aria-labelledby="home-tab">
                    <h3>90 Day Summary as of @reportDate.ToShortDateString()</h3>

                    @{
                        decimal SummaryTotalVehicles = 0;
                        decimal SummaryTotalSold = 0;
                        //decimal SummaryAverageDays = 0;
                        decimal SummaryListAmount = 0;
                        decimal SummaryCostAmount = 0;
                        decimal SummaryNewListAmount = 0;
                        decimal SummaryDiffCostToMarket = 0;
                        decimal SummaryLastAdjust = 0;
                        decimal SummarySoldLoss = 0;
                        decimal SummarySoldAll = 0;
                        int SummaryDaysTotal = 0;
                    }
                    <table class="table table-responsive table-bordered table-striped" id="vehicleListing-summary" style="font-size:11px;">
                        <thead>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Location</th>
                                <th class="text-center"># Units</th>
                                <th class="text-center"># Sold</th>
                                <th class="text-center">Avg Days</th>
                                <th class="text-center">List Amount</th>
                                <th class="text-center">Cost Amount</th>
                                <th class="text-center">New List Amount</th>
                                <th class="text-center">Diff Cost To Market</th>
                                <th class="text-center">Last Adjust</th>
                                <th class="text-center">Sold Front Loss</th>
                                <th class="text-center">Sold Front All</th>

                            </tr>
                        </thead>
                        <tbody>

                            @foreach (var location in locations)
                            {
                                var storeVehicles = Model.UsedVehicles.FindAll(x => x.Location == @location);


                                decimal StoreListAmountTotal = 0;
                                decimal StoreCostAmountTotal = 0;
                                decimal StoreNewListAmountTotal = 0;
                                decimal StoreDiffToMarketAmountTotal = 0;

                                int StoreSoldCount = 0;
                                decimal StoreSoldAmountTotal = 0;
                                decimal StoreVehicleProfitTotal = 0;
                                decimal StoreVehicleLossTotal = 0;

                                int StoreDaysTotal = 0;
                                int StoreVehicleCount = 0;

                                var StoreaverageDays = 0;

                                StoreVehicleCount = storeVehicles.Count;

                                foreach (var vehicle in storeVehicles)
                                {

                                    var diffToMarket = vehicle.ListAmount - vehicle.CostAmount;
                                    StoreDaysTotal += vehicle.DaysInventory;

                                    StoreListAmountTotal += vehicle.ListAmount;
                                    StoreCostAmountTotal += vehicle.CostAmount;
                                    StoreNewListAmountTotal += vehicle.NewListAmount;
                                    StoreDiffToMarketAmountTotal += diffToMarket;

                                    decimal vehicleProfit = 0;

                                    if (vehicle.IsSold)
                                    {
                                        vehicleProfit = vehicle.SellPrice - vehicle.CostAmount;
                                        StoreSoldCount += 1;
                                        StoreSoldAmountTotal += vehicle.SellPrice;
                                        StoreVehicleProfitTotal += vehicleProfit;

                                        if (vehicleProfit < 0)
                                        {
                                            StoreVehicleLossTotal += vehicleProfit;
                                        }
                                    }

                                    StoreaverageDays = (int)(StoreDaysTotal / StoreVehicleCount);

                                }


                                var profitIndicator = "";
                                var lossIndicator = "";

                                if (StoreVehicleProfitTotal < 0)
                                {
                                    profitIndicator = "style=color:red";
                                }

                                if (StoreVehicleLossTotal < 0)
                                {
                                    lossIndicator = "style=color:red";
                                }

                                <tr>

                                    <td class="text-center">@location</td>
                                    <td class="text-center">@StoreVehicleCount</td>
                                    <td class="text-center">@StoreSoldCount</td>
                                    <td class="text-center">@StoreaverageDays</td>
                                    <td class="text-center">@StoreListAmountTotal.ToString("C", nfi)</td>
                                    <td class="text-center">@StoreCostAmountTotal.ToString("C", nfi)</td>
                                    <td class="text-center">@StoreNewListAmountTotal.ToString("C", nfi)</td>
                                    <td class="text-center">@StoreDiffToMarketAmountTotal.ToString("C", nfi)</td>
                                    <td class="text-center">0</td>
                                    <td class="text-center" @lossIndicator>@StoreVehicleLossTotal.ToString("C", nfi)</td>
                                    <td class="text-center" @profitIndicator>@StoreVehicleProfitTotal.ToString("C", nfi)</td>
                                </tr>

                                SummaryTotalVehicles += StoreVehicleCount;
                                SummaryTotalSold += StoreSoldCount;
                                SummaryDaysTotal += StoreDaysTotal;
                                SummaryListAmount += StoreListAmountTotal;
                                SummaryCostAmount += StoreCostAmountTotal;
                                SummaryNewListAmount += StoreNewListAmountTotal;
                                SummaryDiffCostToMarket += StoreDiffToMarketAmountTotal;
                                SummaryLastAdjust += 0;
                                SummarySoldLoss += StoreVehicleLossTotal;
                                SummarySoldAll += StoreVehicleProfitTotal;

                            }

                            @{
                                var SummaryAverageDays = 0;
                                if (SummaryTotalVehicles > 0)
                                {
                                    SummaryAverageDays = (int)(SummaryDaysTotal / SummaryTotalVehicles);
                                }


                                var profitSummaryIndicator = "";
                                var lossSummaryIndicator = "";

                                if (SummarySoldAll < 0)
                                {
                                    profitSummaryIndicator = "style=color:red";
                                }

                                if (SummarySoldLoss < 0)
                                {
                                    lossSummaryIndicator = "style=color:red";
                                }

                                decimal SummarySoldPercent = 0;
                                if (SummaryTotalVehicles > 0)
                                {
                                    SummarySoldPercent = SummaryTotalSold / SummaryTotalVehicles;
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Totals</th>
                                <th class="text-center">@SummaryTotalVehicles</th>
                                <th class="text-center">@SummaryTotalSold</th>
                                <th class="text-center">@SummaryAverageDays</th>
                                <th class="text-center">@SummaryListAmount.ToString("C", nfi)</th>
                                <th class="text-center">@SummaryCostAmount.ToString("C", nfi)</th>
                                <th class="text-center">@SummaryNewListAmount.ToString("C", nfi)</th>
                                <th class="text-center">@SummaryDiffCostToMarket.ToString("C", nfi)</th>
                                <th class="text-center">@SummaryLastAdjust.ToString("C", nfi)</th>
                                <th class="text-center" @lossSummaryIndicator>@SummarySoldLoss.ToString("C", nfi)</th>
                                <th class="text-center" @profitSummaryIndicator>@SummarySoldAll.ToString("C", nfi)</th>

                            </tr>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center" colspan="2">&nbsp;</th>
                                <th class="text-center">@SummarySoldPercent.ToString("P", nfi)</th>
                                <th class="text-center" colspan="8">&nbsp;</th>
                            </tr>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Repos</th>
                                <th class="text-center" id="RepoSummaryUnits"></th>
                                <th class="text-center" id="RepoSummarySold"></th>
                                <th class="text-center" id="RepoSummaryDays"></th>
                                <th class="text-center" id="RepoSummaryList"></th>
                                <th class="text-center" id="RepoSummaryCost"></th>
                                <th class="text-center" id="RepoSummaryNewList"></th>
                                <th class="text-center" id="RepoSummaryDiffCost"></th>
                                <th class="text-center" id="RepoSummaryLastAdjust"></th>
                                <th class="text-center" id="RepoSummarySoldLoss"></th>
                                <th class="text-center" id="RepoSummarySoldAll"></th>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="tab-pane fade" id="inventory" role="tabpanel" aria-labelledby="inventory-tab">
                    <h3>Current Inventory Summary as of @DateTime.Now.ToShortDateString()</h3>

                    <table class="table table-responsive table-bordered table-striped" id="inventory-summary" style="font-size:11px;">
                        <thead>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Location</th>
                                <th class="text-center">Inv Amount</th>
                                <th class="text-center">Inv Count</th>
                                <th class="text-center">0-30 Day Count</th>
                                <th class="text-center">0-30 Day %</th>
                                <th class="text-center">31-60 Day Count</th>
                                <th class="text-center">31-60 Day %</th>
                                <th class="text-center">61-90 Day Count</th>
                                <th class="text-center">61-90 Day %</th>
                                <th class="text-center">90+ Day Count</th>
                                <th class="text-center">90+ Day %</th>

                            </tr>
                        </thead>
                        <tbody>

                            @{
                                var TotalCount = 0;
                                decimal TotalAmount = 0;
                                var TotalDayCount30 = 0;
                                var TotalDayCount60 = 0;
                                var TotalDayCount90 = 0;
                                var TotalDayCount90Over = 0;

                            }

                            @foreach (var location in locations)
                            {
                                var storeVehicles = Model.AllUsedVehicles.FindAll(x => x.Location == @location);

                                var TotalInventoryCount = 0;
                                decimal TotalInventoryAmount = 0;
                                var DayCount30 = 0;
                                var DayCount60 = 0;
                                var DayCount90 = 0;
                                var DayCount90Over = 0;

                                foreach (var vehicle in storeVehicles)
                                {
                                    TotalInventoryCount += 1;
                                    TotalInventoryAmount += vehicle.CostAmount;

                                    if (vehicle.DaysInventory > 90)
                                    {
                                        DayCount90Over += 1;
                                    }
                                    else if (vehicle.DaysInventory < 91 && vehicle.DaysInventory > 60)
                                    {
                                        DayCount90 += 1;
                                    }
                                    else if (vehicle.DaysInventory < 61 && vehicle.DaysInventory > 30)
                                    {
                                        DayCount60 += 1;
                                    }
                                    else if (vehicle.DaysInventory < 31)
                                    {
                                        DayCount30 += 1;
                                    }

                                }

                                var DayCount30Percent = ((double)DayCount30 / (double)TotalInventoryCount);
                                var DayCount60Percent = ((double)DayCount60 / (double)TotalInventoryCount);
                                var DayCount90Percent = ((double)DayCount90 / (double)TotalInventoryCount);
                                var DayCount90OverPercent = ((double)DayCount90Over / (double)TotalInventoryCount);

                                TotalDayCount30 += DayCount30;
                                TotalDayCount60 += DayCount60;
                                TotalDayCount90 += DayCount90;
                                TotalDayCount90Over += DayCount90Over;

                                TotalCount += TotalInventoryCount;
                                TotalAmount += TotalInventoryAmount;

                                <tr>
                                    <td class="text-center">@location</td>
                                    <td class="text-center">@TotalInventoryAmount.ToString("C", nfi)</td>
                                    <td class="text-center"><a href="@applicationPath/Home/Inventory/@location/0/0/@Model.ReportFilter">@TotalInventoryCount</a></td>
                                    <td class="text-center"><a href="@applicationPath/Home/Inventory/@location/0/30/@Model.ReportFilter">@DayCount30</a></td>
                                    <td class="text-center">@DayCount30Percent.ToString("P", nfi)</td>
                                    <td class="text-center"><a href="@applicationPath/Home/Inventory/@location/30/60/@Model.ReportFilter">@DayCount60</a></td>
                                    <td class="text-center">@DayCount60Percent.ToString("P", nfi)</td>
                                    <td class="text-center"><a href="@applicationPath/Home/Inventory/@location/60/90/@Model.ReportFilter">@DayCount90</a></td>
                                    <td class="text-center">@DayCount90Percent.ToString("P", nfi)</td>
                                    <td class="text-center"><a href="@applicationPath/Home/Inventory/@location/90/0/@Model.ReportFilter">@DayCount90Over</a></td>
                                    <td class="text-center">@DayCount90OverPercent.ToString("P", nfi)</td>
                                </tr>

                            }
                        </tbody>
                        <tfoot>
                            @{
                                var TotalDayCount30Percent = ((double)TotalDayCount30 / (double)TotalCount);
                                var TotalDayCount60Percent = ((double)TotalDayCount60 / (double)TotalCount);
                                var TotalDayCount90Percent = ((double)TotalDayCount90 / (double)TotalCount);
                                var TotalDayCount90OverPercent = ((double)TotalDayCount90Over / (double)TotalCount);

                            }
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Totals</th>
                                <th class="text-center">@TotalAmount.ToString("C", nfi)</th>
                                <th class="text-center"><a href="@applicationPath/Home/Inventory/ALL/0/0/@Model.ReportFilter">@TotalCount</a></th>
                                <th class="text-center"><a href="@applicationPath/Home/Inventory/ALL/0/30/@Model.ReportFilter">@TotalDayCount30</a></th>
                                <th class="text-center">@TotalDayCount30Percent.ToString("P", nfi)</th>
                                <th class="text-center"><a href="@applicationPath/Home/Inventory/ALL/30/60/@Model.ReportFilter">@TotalDayCount60</a></th>
                                <th class="text-center">@TotalDayCount60Percent.ToString("P", nfi)</th>
                                <th class="text-center"><a href="@applicationPath/Home/Inventory/ALL/60/90/@Model.ReportFilter">@TotalDayCount90</a></th>
                                <th class="text-center">@TotalDayCount90Percent.ToString("P", nfi)</th>
                                <th class="text-center"><a href="@applicationPath/Home/Inventory/ALL/90/0/@Model.ReportFilter">@TotalDayCount90Over</a></th>
                                <th class="text-center">@TotalDayCount90OverPercent.ToString("P", nfi)</th>
                            </tr>

                        </tfoot>
                    </table>

                </div>

                <div class="tab-pane fade" id="status8" role="tabpanel" aria-labelledby="status8-tab">
                    <h3>Wholesale Status 8 Vehicles</h3>

                    @{
                        decimal WholesaleTotalVehicles = 0;
                        decimal WholesaleTotalAmount = 0;

                        decimal TotalClearTitle = 0;
                        decimal TotalTitleBank = 0;
                        decimal TotalTitleCustomer = 0;
                        decimal TotalTitleInterco = 0;
                        decimal TotalTitleAuction = 0;
                        decimal TotalLienBank = 0;
                        decimal TotalLienCustomer = 0;
                        decimal TotalOdomCustomer = 0;
                        decimal TotalPOACustomer = 0;
                        decimal TotalPayoffCustomer = 0;
                        decimal TotalOutStateTitle = 0;
                        decimal TotalDupTitle = 0;
                        decimal TotalOther = 0;
                        decimal TotalNoStatus = 0;
                        decimal TotalNoTitleDispose = 0;
                        decimal TotalETitle = 0;

                    }
                    <table class="table table-responsive table-bordered table-striped" id="status8-vehicles" style="font-size:11px;">
                        <thead>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Loc</th>
                                <th class="text-center">Stock #</th>
                                <th class="text-center">Year</th>
                                <th class="text-center">Make</th>
                                <th class="text-center">Model</th>
                                <th class="text-center">VIN</th>
                                <th class="text-center">Exterior Color</th>
                                <th class="text-center">Mileage</th>
                                <th class="text-center">Days in Inventory</th>
                                <th class="text-center">Days at Status</th>
                                @*<th class="text-center">List Amount</th>*@
                                <th class="text-center">Acct Inv Amount</th>
                                <th class="text-center">Title Status</th>
                                <th class="text-center">Title Updated</th>
                                <th class="text-center">Memo 2</th>
                                <th class="text-center">Lot</th>
                                <th class="text-center">Sold</th>
                                <th class="text-center">Notes</th>
                            </tr>
                        </thead>

                        <tbody>
                            @{

                                var wholesaleVehicles = Model.AuctionVehicles.FindAll(x => x.Status == 8);

                                foreach (var vehicle in wholesaleVehicles)
                                {

                                    var titleDue = titleStatus.Find(x => x.VIN == vehicle.VIN);

                                    var ManagerNoStatus = true;
                                    var status = "";

                                    var statusUpdated = "";

                                    if (titleDue != null)
                                    {
                                        statusUpdated = titleDue.UpdateDate.ToShortDateString();
                                        if (titleDue.ClearTitle)
                                        {
                                            status += "Clear Title, ";
                                            TotalClearTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueBank)
                                        {
                                            status += "Title Bank, ";
                                            TotalTitleBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueCustomer)
                                        {
                                            status += "Title Customer, ";
                                            TotalTitleCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueInterco)
                                        {
                                            status += "Title Interco, ";
                                            TotalTitleInterco += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueAuction)
                                        {
                                            status += "Title Auction, ";
                                            TotalTitleAuction += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.LienDueBank)
                                        {
                                            status += "Lien Bank, ";
                                            TotalLienBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.LienDueCustomer)
                                        {
                                            status += "Lien Customer, ";
                                            TotalLienCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.OdomDueCustomer)
                                        {
                                            status += "Odom Customer, ";
                                            TotalOdomCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.POADueCust)
                                        {
                                            status += "POA Due, ";
                                            TotalPOACustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.PayoffDueCust)
                                        {
                                            status += "Payoff Due, ";
                                            TotalPayoffCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.WaitingOutSTTitle)
                                        {
                                            status += "Waiting Out, ";
                                            TotalOutStateTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.DuplicateTitleAppliedFor)
                                        {
                                            status += "Dup Title, ";
                                            TotalDupTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.Other)
                                        {
                                            status += "Other, ";
                                            TotalOther += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.NoTitleDispose)
                                        {
                                            status += "No Title Dispose, ";
                                            TotalNoTitleDispose += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.ElectronicTitle)
                                        {
                                            status += "E-Title, ";
                                            TotalETitle += 1;
                                            ManagerNoStatus = false;
                                        }

                                    }

                                    if (ManagerNoStatus)
                                    {
                                        status = "No Status";
                                        TotalNoStatus += 1;
                                    }
                                    status = status.TrimEnd(' ').TrimEnd(',');

                                    WholesaleTotalVehicles += 1;
                                    WholesaleTotalAmount += vehicle.CostAmount;

                                    var titleLink = "http://jjfserver/SalesCommission/Reports/UpdateTitleDue?vin=" + vehicle.VIN;
                                    if (ManagerNoStatus)
                                    {
                                        titleLink = "http://jjfserver/SalesCommission/Reports/AddTitleDue?vin=" + vehicle.VIN;
                                    }

                                    var invHistory = Model.InventoryStatusHistory.FindAll(x => x.stk.Trim() == vehicle.StockNumber.Trim()).OrderByDescending(x => x.UCHISTID);
                                    var statusChangeDate = new DateTime();

                                    foreach (var hist in invHistory)
                                    {
                                        if (hist.status != vehicle.Status)
                                        {
                                            statusChangeDate = hist.updated;
                                            break;
                                        }
                                    }

                                    Int32 invStatusDays = 0;
                                    if (statusChangeDate == new DateTime())
                                    {
                                        invStatusDays = vehicle.DaysInventory;
                                    }
                                    else
                                    {
                                        invStatusDays = (Int32)(DateTime.Now - statusChangeDate).TotalDays;
                                    }

                                    var vehicleNotes = Model.AllVehicleNotes.Find(x => x.VIN == vehicle.VIN && x.InventoryStatus == 8);

                                    var lotLocation = "";
                                    var Notes = "";
                                    var soldDate = new DateTime();

                                    if (vehicleNotes != null)
                                    {
                                        lotLocation = vehicleNotes.LotLocation;
                                        Notes = vehicleNotes.Notes;
                                        soldDate = vehicleNotes.VehicleSoldDate;
                                    }

                                    <tr>
                                        <td class="text-center">@vehicle.Location</td>
                                        <td class="text-center">@vehicle.StockNumber</td>
                                        <td class="text-center">@vehicle.ModelYear</td>
                                        <td class="text-center">@vehicle.Make</td>
                                        <td class="text-center">@vehicle.Model</td>
                                        <td class="text-center">@vehicle.VIN</td>
                                        <td class="text-center">@vehicle.Color</td>
                                        <td class="text-center">@vehicle.Miles</td>
                                        <td class="text-center">@vehicle.DaysInventory</td>
                                        <td class="text-center">@invStatusDays</td>
                                        @*<td class="text-center">@vehicle.ListAmount.ToString("C", nfi)</td>*@
                                        <td class="text-center">@vehicle.CostAmount.ToString("C", nfi)</td>
                                        <td class="text-center"><a href="@titleLink" target="blank">@status</a></td>
                                        <td class="text-center">@statusUpdated</td>
                                        <td class="text-center">@vehicle.Memo2</td>
                                        <td class="text-center">@lotLocation</td>
                                        <td class="text-center">
                                            @if (soldDate.ToShortDateString() != "1/1/0001" && soldDate.ToShortDateString() != "1/1/1900")
                                            {
                                                @:@soldDate.ToShortDateString()
                                        }
                                        </td>
                                        <td class="text-center">
                                            <a class="status8editInfo" data-vin="@vehicle.VIN" data-stock="@vehicle.StockNumber"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a><br />
                                            @if (Notes != null && Notes != "")
                                            {
                                                <a href="#" data-toggle="tooltip" title="@Notes">
                                                    <i class="fa fa-comments-o" aria-hidden="true"></i>
                                                </a>
                                            }
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Totals</th>
                                <th class="text-center">@WholesaleTotalVehicles</th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center">@WholesaleTotalAmount.ToString("C", nfi)</th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>

                                <th class="text-right" colspan="3">
                                    ClearTitle<br />
                                    Title Due Bank<br />
                                    Title Due Customer<br />
                                    Title Due Interco<br />
                                    Title Due Auction<br />
                                    Lien Due Bank<br />
                                    Lien Due Customer<br />
                                    Odom Due Customer<br />
                                    POA Due Customer<br />
                                    Payoff Due Customer<br />
                                    Out of State Title<br />
                                    Duplicate Title<br />
                                    No Title Dispose<br />
                                    E-Title<br />
                                    Other<br />
                                    No Status<br />
                                </th>
                                <th class="text-center">
                                    @TotalClearTitle<br />
                                    @TotalTitleBank<br />
                                    @TotalTitleCustomer<br />
                                    @TotalTitleInterco<br />
                                    @TotalTitleAuction<br />
                                    @TotalLienBank<br />
                                    @TotalLienCustomer<br />
                                    @TotalOdomCustomer<br />
                                    @TotalPOACustomer<br />
                                    @TotalPayoffCustomer<br />
                                    @TotalOutStateTitle<br />
                                    @TotalDupTitle<br />
                                    @TotalNoTitleDispose<br />
                                    @TotalETitle<br />
                                    @TotalOther<br />
                                    @TotalNoStatus<br />
                                </th>
                            </tr>
                        </tfoot>
                    </table>

                    <script type="text/javascript">
                        $(document).ready(function () {
                            $('#status8-vehicles').DataTable({
                                searching: true,
                                dom: 'Bfrtip',
                                pageLength: -1,
                                order: [[0, "asc"],[8,"desc"]],
                                buttons: [
                                    {
                                        extend: 'copyHtml5', footer: true,
                                    },
                                    {
                                        extend: 'excelHtml5', footer: true,
                                    },
                                    {
                                        extend: 'pdfHtml5', footer: true,
                                        orientation: 'landscape'
                                    },
                                    {
                                        extend: 'print', footer: true,
                                        orientation: 'landscape'
                                    }
                                ],
                                columnDefs: [
                                  { type: 'any-number', targets: [7, 8, 9, 10]},
                                   { type: 'date', targets: [12, 15] },
                                ]

                            });
                        });

                        $(document).ready(function () {

                            $('[data-toggle="tooltip"]').tooltip();

                            var dialogWidth = 0;

                            dialogWidth = ($(window).width() * .75);

                            if ($(window).width() > 1199) {
                                dialogWidth = 1200;
                            }

                            $('body').on('click', '.status8editInfo', function (event) {
                                var vin = $(this).attr("data-vin");

                                var url = "@applicationPath/Home/VehicleNotes/?status=8&vin=" + vin;
                                var dialogBox = $("<div>");

                                $(dialogBox).dialog({
                                    resizable: false,
                                    height: "auto",
                                    width: dialogWidth,
                                    position: { my: "center", at: "top+25%", of: window },
                                    title: 'Update Vehicle Notes',
                                    modal: true,
                                    open: function (event, ui) {
                                        $(this).load(url);
                                        //$('#BonusDraws').validate();
                                    },
                                    buttons: {
                                        "Save": function () {
                                            var $this = this;
                                            var form = $('#UpdateVehicleNotes', $this);
                                            //if (!$(form).valid()) {
                                            //    return false;
                                            //}

                                            $.ajax({
                                                async: false,
                                                type: 'POST',
                                                url: form.attr("action"),
                                                data: $(form).serialize(),
                                                success: $($this).dialog("close").dialog("destroy").remove()
                                            });

                                            //location.reload();
                                        },

                                        "Close": function () {
                                            $(this).dialog("close");
                                            $(this).empty();
                                        }
                                    }
                                });
                                $(dialogBox).dialog('open');
                            });


                        });

                    </script>

                </div>

                <div class="tab-pane fade" id="status9" role="tabpanel" aria-labelledby="status9-tab">
                    <h3>Wholesale Auction Status 9 Vehicles</h3>

                    @{
                        decimal AuctionTotalVehicles = 0;
                        decimal AuctionTotalAmount = 0;
                    }
                    <table class="table table-responsive table-bordered table-striped" id="status9-vehicles" style="font-size:11px;">
                        <thead>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Loc</th>
                                <th class="text-center">Stock #</th>
                                <th class="text-center">Year</th>
                                <th class="text-center">Make</th>
                                <th class="text-center">Model</th>
                                <th class="text-center">VIN</th>
                                <th class="text-center">Exterior Color</th>
                                <th class="text-center">Mileage</th>
                                <th class="text-center">Days in Inventory</th>
                                <th class="text-center">Days at Status</th>
                                @*<th class="text-center">List Amount</th>*@
                                <th class="text-center">Acct Inv Amount</th>
                                <th class="text-center">Title Status</th>
                                <th class="text-center">Title Updated</th>
                                <th class="text-center">Memo 2</th>
                                <th class="text-center">Lot</th>
                                <th class="text-center">Sold</th>
                                <th class="text-center">Notes</th>

                            </tr>
                        </thead>

                        <tbody>
                            @{

                                var wholesaleAuctionVehicles = Model.AuctionVehicles.FindAll(x => x.Status == 9);

                                TotalClearTitle = 0;
                                TotalTitleBank = 0;
                                TotalTitleCustomer = 0;
                                TotalTitleInterco = 0;
                                TotalTitleAuction = 0;
                                TotalLienBank = 0;
                                TotalLienCustomer = 0;
                                TotalOdomCustomer = 0;
                                TotalPOACustomer = 0;
                                TotalPayoffCustomer = 0;
                                TotalOutStateTitle = 0;
                                TotalDupTitle = 0;
                                TotalOther = 0;
                                TotalNoStatus = 0;

                                TotalNoTitleDispose = 0;
                                TotalETitle = 0;

                                foreach (var vehicle in wholesaleAuctionVehicles)
                                {
                                    var titleDue = titleStatus.Find(x => x.VIN == vehicle.VIN);

                                    var ManagerNoStatus = true;
                                    var status = "";
                                    var statusUpdated = "";

                                    if (titleDue != null)
                                    {
                                        statusUpdated = titleDue.UpdateDate.ToShortDateString();
                                        if (titleDue.ClearTitle)
                                        {
                                            status += "Clear Title, ";
                                            TotalClearTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueBank)
                                        {
                                            status += "Title Bank, ";
                                            TotalTitleBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueCustomer)
                                        {
                                            status += "Title Customer, ";
                                            TotalTitleCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueInterco)
                                        {
                                            status += "Title Interco, ";
                                            TotalTitleInterco += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueAuction)
                                        {
                                            status += "Title Auction, ";
                                            TotalTitleAuction += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.LienDueBank)
                                        {
                                            status += "Lien Bank, ";
                                            TotalLienBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.LienDueCustomer)
                                        {
                                            status += "Lien Customer, ";
                                            TotalLienCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.OdomDueCustomer)
                                        {
                                            status += "Odom Customer, ";
                                            TotalOdomCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.POADueCust)
                                        {
                                            status += "POA Due, ";
                                            TotalPOACustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.PayoffDueCust)
                                        {
                                            status += "Payoff Due, ";
                                            TotalPayoffCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.WaitingOutSTTitle)
                                        {
                                            status += "Waiting Out, ";
                                            TotalOutStateTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.DuplicateTitleAppliedFor)
                                        {
                                            status += "Dup Title, ";
                                            TotalDupTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.Other)
                                        {
                                            status += "Other, ";
                                            TotalOther += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.NoTitleDispose)
                                        {
                                            status += "No Title Dispose, ";
                                            TotalNoTitleDispose += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.ElectronicTitle)
                                        {
                                            status += "E-Title, ";
                                            TotalETitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                    }

                                    if (ManagerNoStatus)
                                    {
                                        status = "No Status";
                                        TotalNoStatus += 1;
                                    }
                                    status = status.TrimEnd(' ').TrimEnd(',');

                                    AuctionTotalVehicles += 1;
                                    AuctionTotalAmount += vehicle.CostAmount;

                                    var titleLink = "http://jjfserver/SalesCommission/Reports/UpdateTitleDue?vin=" + vehicle.VIN;
                                    if (ManagerNoStatus)
                                    {
                                        titleLink = "http://jjfserver/SalesCommission/Reports/AddTitleDue?vin=" + vehicle.VIN;
                                    }

                                    var invHistory = Model.InventoryStatusHistory.FindAll(x => x.stk.Trim() == vehicle.StockNumber.Trim()).OrderByDescending(x => x.UCHISTID);
                                    var statusChangeDate = new DateTime();

                                    if (vehicle.StockNumber == "G31885B")
                                    {
                                        var x = "holy shit";
                                    }

                                    foreach (var hist in invHistory)
                                    {
                                        if (hist.status != vehicle.Status)
                                        {
                                            statusChangeDate = hist.updated;
                                            break;
                                        }
                                    }

                                    Int32 invStatusDays = 0;
                                    if (statusChangeDate == new DateTime())
                                    {
                                        invStatusDays = vehicle.DaysInventory;
                                    }
                                    else
                                    {
                                        invStatusDays = (Int32)(DateTime.Now - statusChangeDate).TotalDays;
                                    }

                                    var vehicleNotes = Model.AllVehicleNotes.Find(x => x.VIN == vehicle.VIN && x.InventoryStatus == 9);

                                    var lotLocation = "";
                                    var Notes = "";
                                    var soldDate = new DateTime();

                                    if (vehicleNotes != null)
                                    {
                                        lotLocation = vehicleNotes.LotLocation;
                                        Notes = vehicleNotes.Notes;
                                        soldDate = vehicleNotes.VehicleSoldDate;
                                    }

                                    <tr>
                                        <td class="text-center">@vehicle.Location</td>
                                        <td class="text-center">@vehicle.StockNumber</td>
                                        <td class="text-center">@vehicle.ModelYear</td>
                                        <td class="text-center">@vehicle.Make</td>
                                        <td class="text-center">@vehicle.Model</td>
                                        <td class="text-center">@vehicle.VIN</td>
                                        <td class="text-center">@vehicle.Color</td>
                                        <td class="text-center">@vehicle.Miles</td>
                                        <td class="text-center">@vehicle.DaysInventory</td>
                                        <td class="text-center">@invStatusDays</td>
                                        @*<td class="text-center">@vehicle.ListAmount.ToString("C", nfi)</td>*@
                                        <td class="text-center">@vehicle.CostAmount.ToString("C", nfi)</td>
                                        <td class="text-center"><a href="@titleLink" target="blank">@status</a></td>
                                        <td class="text-center">@statusUpdated</td>
                                        <td class="text-center">@vehicle.Memo2</td>
                                        <td class="text-center">@lotLocation</td>
                                        <td class="text-center">
                                            @if (soldDate.ToShortDateString() != "1/1/0001" && soldDate.ToShortDateString() != "1/1/1900")
                                            {
                                                @:@soldDate.ToShortDateString()
                                        }
                                        </td>
                                        <td class="text-center">
                                            <a class="status9editInfo" data-vin="@vehicle.VIN" data-stock="@vehicle.StockNumber"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a><br />
                                            @if (Notes != null && Notes != "")
                                            {
                                                <a href="#" data-toggle="tooltip" title="@Notes">
                                                    <i class="fa fa-comments-o" aria-hidden="true"></i>
                                                </a>
                                            }
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Totals</th>
                                <th class="text-center">@AuctionTotalVehicles</th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center">@AuctionTotalAmount.ToString("C", nfi)</th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-right" colspan="3">
                                    ClearTitle<br />
                                    Title Due Bank<br />
                                    Title Due Customer<br />
                                    Title Due Interco<br />
                                    Title Due Auction<br />
                                    Lien Due Bank<br />
                                    Lien Due Customer<br />
                                    Odom Due Customer<br />
                                    POA Due Customer<br />
                                    Payoff Due Customer<br />
                                    Out of State Title<br />
                                    Duplicate Title<br />
                                    No Title Dispose<br />
                                    E-Title<br />
                                    Other<br />
                                    No Status<br />
                                </th>
                                <th class="text-center">
                                    @TotalClearTitle<br />
                                    @TotalTitleBank<br />
                                    @TotalTitleCustomer<br />
                                    @TotalTitleInterco<br />
                                    @TotalTitleAuction<br />
                                    @TotalLienBank<br />
                                    @TotalLienCustomer<br />
                                    @TotalOdomCustomer<br />
                                    @TotalPOACustomer<br />
                                    @TotalPayoffCustomer<br />
                                    @TotalOutStateTitle<br />
                                    @TotalDupTitle<br />
                                    @TotalNoTitleDispose<br />
                                    @TotalETitle<br />
                                    @TotalOther<br />
                                    @TotalNoStatus<br />
                                </th>
                            </tr>
                        </tfoot>
                    </table>

                    <script type="text/javascript">
                        $(document).ready(function () {
                            $('#status9-vehicles').DataTable({
                                searching: true,
                                dom: 'Bfrtip',
                                pageLength: -1,
                                order: [[0, "asc"], [8, "desc"]],
                                buttons: [
                                    {
                                        extend: 'copyHtml5', footer: true,
                                    },
                                    {
                                        extend: 'excelHtml5', footer: true,
                                    },
                                    {
                                        extend: 'pdfHtml5', footer: true,
                                        orientation: 'landscape'
                                    },
                                    {
                                        extend: 'print', footer: true,
                                        orientation: 'landscape'
                                    }
                                ],
                                columnDefs: [
                                  { type: 'any-number', targets: [ 7, 8, 9, 10] },
                                   { type: 'date', targets: [12, 15] },
                                ]

                            });
                        });

                        $(document).ready(function () {

                            $('[data-toggle="tooltip"]').tooltip();

                            var dialogWidth = 0;

                            dialogWidth = ($(window).width() * .75);

                            if ($(window).width() > 1199) {
                                dialogWidth = 1200;
                            }

                            $('body').on('click', '.status9editInfo', function (event) {
                                var vin = $(this).attr("data-vin");

                                var url = "@applicationPath/Home/VehicleNotes/?status=9&vin=" + vin;
                                var dialogBox = $("<div>");

                                $(dialogBox).dialog({
                                    resizable: false,
                                    height: "auto",
                                    width: dialogWidth,
                                    position: { my: "center", at: "top+25%", of: window },
                                    title: 'Update Vehicle Notes',
                                    modal: true,
                                    open: function (event, ui) {
                                        $(this).load(url);
                                        //$('#BonusDraws').validate();
                                    },
                                    buttons: {
                                        "Save": function () {
                                            var $this = this;
                                            var form = $('#UpdateVehicleNotes', $this);
                                            //if (!$(form).valid()) {
                                            //    return false;
                                            //}

                                            $.ajax({
                                                async: false,
                                                type: 'POST',
                                                url: form.attr("action"),
                                                data: $(form).serialize(),
                                                success: $($this).dialog("close").dialog("destroy").remove()
                                            });

                                            //location.reload();
                                        },

                                        "Close": function () {
                                            $(this).dialog("close");
                                            $(this).empty();
                                        }
                                    }
                                });
                                $(dialogBox).dialog('open');
                            });
                        });
                    </script>

                </div>

                <div class="tab-pane fade" id="status3" role="tabpanel" aria-labelledby="status3-tab">
                    <h3>Status 3 Vehicles</h3>

                    @{
                        decimal Status3TotalVehicles = 0;
                        decimal Status3TotalAmount = 0;
                    }
                    <table class="table table-responsive table-bordered table-striped" id="status3-vehicles" style="font-size:11px;">
                        <thead>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Loc</th>
                                <th class="text-center">Stock #</th>
                                <th class="text-center">Year</th>
                                <th class="text-center">Make</th>
                                <th class="text-center">Model</th>
                                <th class="text-center">VIN</th>
                                <th class="text-center">Exterior Color</th>
                                <th class="text-center">In Service Miles</th>
                                <th class="text-center">Days in Inventory</th>
                                <th class="text-center">Days at Status</th>
                                @*<th class="text-center">List Amount</th>*@
                                <th class="text-center">Acct Inv Amount</th>
                                <th class="text-center">Title Status</th>
                                <th class="text-center">Memo 1</th>
                                <th class="text-center">Memo 2</th>
                                <th class="text-center">Last Service Date</th>
                                <th class="text-center">Last RO Miles</th>
                                <th class="text-center">Recall Status</th>
                                <th class="text-center">Notes</th>

                            </tr>
                        </thead>

                        <tbody>
                            @{

                                var status3Vehicles = Model.OtherStatusVehicles.FindAll(x => x.Status == 3);

                                TotalClearTitle = 0;
                                TotalTitleBank = 0;
                                TotalTitleCustomer = 0;
                                TotalTitleInterco = 0;
                                TotalTitleAuction = 0;
                                TotalLienBank = 0;
                                TotalLienCustomer = 0;
                                TotalOdomCustomer = 0;
                                TotalPOACustomer = 0;
                                TotalPayoffCustomer = 0;
                                TotalOutStateTitle = 0;
                                TotalDupTitle = 0;
                                TotalOther = 0;
                                TotalNoStatus = 0;

                                TotalNoTitleDispose = 0;
                                TotalETitle = 0;

                                foreach (var vehicle in status3Vehicles)
                                {
                                    var titleDue = titleStatus.Find(x => x.VIN == vehicle.VIN);

                                    var ManagerNoStatus = true;
                                    var status = "";

                                    if (titleDue != null)
                                    {
                                        if (titleDue.ClearTitle)
                                        {
                                            status += "Clear Title, ";
                                            TotalClearTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueBank)
                                        {
                                            status += "Title Bank, ";
                                            TotalTitleBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueCustomer)
                                        {
                                            status += "Title Customer, ";
                                            TotalTitleCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueInterco)
                                        {
                                            status += "Title Interco, ";
                                            TotalTitleInterco += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueAuction)
                                        {
                                            status += "Title Auction, ";
                                            TotalTitleAuction += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.LienDueBank)
                                        {
                                            status += "Lien Bank, ";
                                            TotalLienBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.LienDueCustomer)
                                        {
                                            status += "Lien Customer, ";
                                            TotalLienCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.OdomDueCustomer)
                                        {
                                            status += "Odom Customer, ";
                                            TotalOdomCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.POADueCust)
                                        {
                                            status += "POA Due, ";
                                            TotalPOACustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.PayoffDueCust)
                                        {
                                            status += "Payoff Due, ";
                                            TotalPayoffCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.WaitingOutSTTitle)
                                        {
                                            status += "Waiting Out, ";
                                            TotalOutStateTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.DuplicateTitleAppliedFor)
                                        {
                                            status += "Dup Title, ";
                                            TotalDupTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.Other)
                                        {
                                            status += "Other, ";
                                            TotalOther += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.NoTitleDispose)
                                        {
                                            status += "No Title Dispose, ";
                                            TotalNoTitleDispose += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.ElectronicTitle)
                                        {
                                            status += "E-Title, ";
                                            TotalETitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                    }

                                    if (ManagerNoStatus)
                                    {
                                        status = "No Status";
                                        TotalNoStatus += 1;
                                    }
                                    status = status.TrimEnd(' ').TrimEnd(',');

                                    Status3TotalVehicles += 1;
                                    Status3TotalAmount += vehicle.CostAmount;

                                    var titleLink = "http://jjfserver/SalesCommission/Reports/UpdateTitleDue?vin=" + vehicle.VIN;
                                    if (ManagerNoStatus)
                                    {
                                        titleLink = "http://jjfserver/SalesCommission/Reports/AddTitleDue?vin=" + vehicle.VIN;
                                    }

                                    var invHistory = Model.InventoryStatusHistory.FindAll(x => x.stk.Trim() == vehicle.StockNumber.Trim()).OrderByDescending(x => x.UCHISTID);
                                    var statusChangeDate = new DateTime();

                                    foreach (var hist in invHistory)
                                    {
                                        if (hist.status != vehicle.Status)
                                        {
                                            statusChangeDate = hist.updated;
                                            break;
                                        }
                                    }

                                    Int32 invStatusDays = 0;
                                    if (statusChangeDate == new DateTime())
                                    {
                                        invStatusDays = vehicle.DaysInventory;
                                    }
                                    else
                                    {
                                        invStatusDays = (Int32)(DateTime.Now - statusChangeDate).TotalDays;
                                    }

                                    var vehicleNotes = Model.AllVehicleNotes.Find(x => x.VIN == vehicle.VIN && x.InventoryStatus == 3);
                                    var Notes = "";

                                    if (vehicleNotes != null)
                                    {
                                        Notes = vehicleNotes.Notes;
                                    }

                                    var recalls = Model.AllOpenRecalls.FindAll(x => x.StockNo.Trim() == vehicle.StockNumber.Trim() && x.VIN.Trim() == vehicle.VIN.Trim());

                                    var recallNotes = "";
                                    foreach (var recall in recalls)
                                    {
                                        recallNotes += recall.Description + ", ";
                                    }
                                    recallNotes = recallNotes.TrimEnd(' ').TrimEnd(',');

                                    <tr>
                                        <td class="text-center">@vehicle.Location</td>
                                        <td class="text-center">@vehicle.StockNumber</td>
                                        <td class="text-center">@vehicle.ModelYear</td>
                                        <td class="text-center">@vehicle.Make</td>
                                        <td class="text-center">@vehicle.Model</td>
                                        <td class="text-center">@vehicle.VIN</td>
                                        <td class="text-center">@vehicle.Color</td>
                                        <td class="text-center">@vehicle.Miles</td>
                                        <td class="text-center">@vehicle.DaysInventory</td>
                                        <td class="text-center">@invStatusDays</td>
                                        @*<td class="text-center">@vehicle.ListAmount.ToString("C", nfi)</td>*@
                                        <td class="text-center">@vehicle.CostAmount.ToString("C", nfi)</td>
                                        <td class="text-center"><a href="@titleLink" target="blank">@status</a></td>
                                        <td class="text-center">@vehicle.Memo1</td>
                                        <td class="text-center">@vehicle.Memo2</td>
                                        <td class="text-center">@vehicle.RODate.ToShortDateString()</td>
                                        <td class="text-center">@vehicle.ROMiles</td>
                                        <td class="text-center">

                                            <a href="#" data-toggle="tooltip" title="@recallNotes">
                                                @recalls.Count
                                            </a>
                                        </td>

                                        <td class="text-center">
                                            <a class="status3editInfo" data-vin="@vehicle.VIN" data-stock="@vehicle.StockNumber"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a><br />
                                            @if (Notes != null && Notes != "")
                                            {
                                                <a href="#" data-toggle="tooltip" title="@Notes">
                                                    <i class="fa fa-comments-o" aria-hidden="true"></i>
                                                </a>
                                            }
                                        </td>

                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Totals</th>
                                <th class="text-center">@Status3TotalVehicles</th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center">@Status3TotalAmount.ToString("C", nfi)</th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>

                                @*<th class="text-center"></th>*@

                                <th class="text-right" colspan="3">
                                    ClearTitle<br />
                                    Title Due Bank<br />
                                    Title Due Customer<br />
                                    Title Due Interco<br />
                                    Title Due Auction<br />
                                    Lien Due Bank<br />
                                    Lien Due Customer<br />
                                    Odom Due Customer<br />
                                    POA Due Customer<br />
                                    Payoff Due Customer<br />
                                    Out of State Title<br />
                                    Duplicate Title<br />
                                    No Title Dispose<br />
                                    E-Title<br />
                                    Other<br />
                                    No Status<br />
                                </th>
                                <th class="text-center">
                                    @TotalClearTitle<br />
                                    @TotalTitleBank<br />
                                    @TotalTitleCustomer<br />
                                    @TotalTitleInterco<br />
                                    @TotalTitleAuction<br />
                                    @TotalLienBank<br />
                                    @TotalLienCustomer<br />
                                    @TotalOdomCustomer<br />
                                    @TotalPOACustomer<br />
                                    @TotalPayoffCustomer<br />
                                    @TotalOutStateTitle<br />
                                    @TotalDupTitle<br />
                                    @TotalNoTitleDispose<br />
                                    @TotalETitle<br />
                                    @TotalOther<br />
                                    @TotalNoStatus<br />
                                </th>
                            </tr>
                        </tfoot>
                    </table>

                    <script type="text/javascript">
                        $(document).ready(function () {
                            $('#status3-vehicles').DataTable({
                                searching: true,
                                dom: 'Bfrtip',
                                pageLength: -1,
                                buttons: [
                                    {
                                        extend: 'copyHtml5', footer: true,
                                    },
                                    {
                                        extend: 'excelHtml5', footer: true,
                                    },
                                    {
                                        extend: 'pdfHtml5', footer: true,
                                        orientation: 'landscape'
                                    },
                                    {
                                        extend: 'print', footer: true,
                                        orientation: 'landscape'
                                    }
                                ],
                                columnDefs: [
                                  { type: 'any-number', targets: [ 7, 8, 9, 10] },
                                  { type: 'date', targets: [14] },

                                ]

                            });
                        });
                        $(document).ready(function () {

                            $('[data-toggle="tooltip"]').tooltip();

                            var dialogWidth = 0;

                            dialogWidth = ($(window).width() * .75);

                            if ($(window).width() > 1199) {
                                dialogWidth = 1200;
                            }

                            $('body').on('click', '.status3editInfo', function (event) {
                                var vin = $(this).attr("data-vin");

                                var url = "@applicationPath/Home/VehicleNotes/?status=3&vin=" + vin;
                                var dialogBox = $("<div>");

                                $(dialogBox).dialog({
                                    resizable: false,
                                    height: "auto",
                                    width: dialogWidth,
                                    position: { my: "center", at: "top+25%", of: window },
                                    title: 'Update Vehicle Notes',
                                    modal: true,
                                    open: function (event, ui) {
                                        $(this).load(url);
                                        //$('#BonusDraws').validate();
                                    },
                                    buttons: {
                                        "Save": function () {
                                            var $this = this;
                                            var form = $('#UpdateVehicleNotes', $this);
                                            //if (!$(form).valid()) {
                                            //    return false;
                                            //}

                                            $.ajax({
                                                async: false,
                                                type: 'POST',
                                                url: form.attr("action"),
                                                data: $(form).serialize(),
                                                success: $($this).dialog("close").dialog("destroy").remove()
                                            });

                                            //location.reload();
                                        },

                                        "Close": function () {
                                            $(this).dialog("close");
                                            $(this).empty();
                                        }
                                    }
                                });
                                $(dialogBox).dialog('open');
                            });
                        });
                    </script>

                </div>

                <div class="tab-pane fade" id="status5" role="tabpanel" aria-labelledby="status5-tab">
                    <h3>Status 5 Vehicles</h3>

                    @{
                        decimal Status5TotalVehicles = 0;
                        decimal Status5TotalAmount = 0;
                    }
                    <table class="table table-responsive table-bordered table-striped" id="status5-vehicles" style="font-size:11px;">
                        <thead>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Loc</th>
                                <th class="text-center">Stock #</th>
                                <th class="text-center">Year</th>
                                <th class="text-center">Make</th>
                                <th class="text-center">Model</th>
                                <th class="text-center">VIN</th>
                                <th class="text-center">Exterior Color</th>
                                <th class="text-center">Mileage</th>
                                <th class="text-center">Cost Amount</th>
                                <th class="text-center">Days in Inventory</th>
                                <th class="text-center">Days at Status</th>
                                <th class="text-center">Customer</th>
                                <th class="text-center">Sold Date</th>
                                <th class="text-center">Deal</th>

                                @*<th class="text-center">List Amount</th>
                                    <th class="text-center">Title Status</th>*@
                                <th class="text-center">Notes</th>

                            </tr>
                        </thead>

                        <tbody>
                            @{

                                var status5Vehicles = Model.OtherStatusVehicles.FindAll(x => x.Status == 5);
                                status5Vehicles.AddRange(Model.NewStatus5Vehicles);

                                TotalClearTitle = 0;
                                TotalTitleBank = 0;
                                TotalTitleCustomer = 0;
                                TotalTitleInterco = 0;
                                TotalTitleAuction = 0;
                                TotalLienBank = 0;
                                TotalLienCustomer = 0;
                                TotalOdomCustomer = 0;
                                TotalPOACustomer = 0;
                                TotalPayoffCustomer = 0;
                                TotalOutStateTitle = 0;
                                TotalDupTitle = 0;
                                TotalOther = 0;
                                TotalNoStatus = 0;

                                TotalNoTitleDispose = 0;
                                TotalETitle = 0;

                                foreach (var vehicle in status5Vehicles)
                                {
                                    var titleDue = titleStatus.Find(x => x.VIN == vehicle.VIN);

                                    var ManagerNoStatus = true;
                                    var status = "";

                                    if (titleDue != null)
                                    {
                                        if (titleDue.ClearTitle)
                                        {
                                            status += "Clear Title, ";
                                            TotalClearTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueBank)
                                        {
                                            status += "Title Bank, ";
                                            TotalTitleBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueCustomer)
                                        {
                                            status += "Title Customer, ";
                                            TotalTitleCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueInterco)
                                        {
                                            status += "Title Interco, ";
                                            TotalTitleInterco += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueAuction)
                                        {
                                            status += "Title Auction, ";
                                            TotalTitleAuction += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.LienDueBank)
                                        {
                                            status += "Lien Bank, ";
                                            TotalLienBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.LienDueCustomer)
                                        {
                                            status += "Lien Customer, ";
                                            TotalLienCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.OdomDueCustomer)
                                        {
                                            status += "Odom Customer, ";
                                            TotalOdomCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.POADueCust)
                                        {
                                            status += "POA Due, ";
                                            TotalPOACustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.PayoffDueCust)
                                        {
                                            status += "Payoff Due, ";
                                            TotalPayoffCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.WaitingOutSTTitle)
                                        {
                                            status += "Waiting Out, ";
                                            TotalOutStateTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.DuplicateTitleAppliedFor)
                                        {
                                            status += "Dup Title, ";
                                            TotalDupTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.Other)
                                        {
                                            status += "Other, ";
                                            TotalOther += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.NoTitleDispose)
                                        {
                                            status += "No Title Dispose, ";
                                            TotalNoTitleDispose += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.ElectronicTitle)
                                        {
                                            status += "E-Title, ";
                                            TotalETitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                    }

                                    if (ManagerNoStatus)
                                    {
                                        status = "No Status";
                                        TotalNoStatus += 1;
                                    }
                                    status = status.TrimEnd(' ').TrimEnd(',');

                                    Status5TotalVehicles += 1;
                                    Status5TotalAmount += vehicle.CostAmount;

                                    var titleLink = "http://jjfserver/SalesCommission/Reports/UpdateTitleDue?vin=" + vehicle.VIN;
                                    if (ManagerNoStatus)
                                    {
                                        titleLink = "http://jjfserver/SalesCommission/Reports/AddTitleDue?vin=" + vehicle.VIN;
                                    }

                                    var invHistory = Model.InventoryStatusHistory.FindAll(x => x.stk.Trim() == vehicle.StockNumber.Trim()).OrderByDescending(x => x.UCHISTID);
                                    var statusChangeDate = new DateTime();

                                    foreach (var hist in invHistory)
                                    {
                                        if (hist.status != vehicle.Status)
                                        {
                                            statusChangeDate = hist.updated;
                                            break;
                                        }
                                    }

                                    Int32 invStatusDays = 0;
                                    if (statusChangeDate == new DateTime())
                                    {
                                        invStatusDays = vehicle.DaysInventory;
                                    }
                                    else
                                    {
                                        invStatusDays = (Int32)(DateTime.Now - statusChangeDate).TotalDays;
                                    }

                                    var vehicleNotes = Model.AllVehicleNotes.Find(x => x.VIN == vehicle.VIN && x.InventoryStatus == 5);
                                    var Notes = "";

                                    if (vehicleNotes != null)
                                    {
                                        Notes = vehicleNotes.Notes;
                                    }

                                    <tr>
                                        <td class="text-center">@vehicle.Location</td>
                                        <td class="text-center">@vehicle.StockNumber</td>
                                        <td class="text-center">@vehicle.ModelYear</td>
                                        <td class="text-center">@vehicle.Make</td>
                                        <td class="text-center">@vehicle.Model</td>
                                        <td class="text-center">@vehicle.VIN</td>
                                        <td class="text-center">@vehicle.Color</td>
                                        <td class="text-center">@vehicle.Miles</td>
                                        <td class="text-center">@vehicle.SellPrice.ToString("C", nfi)</td>
                                        <td class="text-center">@vehicle.DaysInventory</td>
                                        <td class="text-center">@invStatusDays</td>
                                        <td class="text-center">@vehicle.CustomerName</td>
                                        <td class="text-center">
                                            @if (vehicle.SoldDate.ToShortDateString() != "1/1/0001" && vehicle.SoldDate.ToShortDateString() != "1/1/1900")
                                            {
                                                @:@vehicle.SoldDate.ToShortDateString()
                                        }
                                        </td>
                                        <td class="text-center"><a href="http://10.254.162.190/SalesCommission/Sales/DealDetail/@vehicle.DealNumber" target="_blank">@vehicle.DealNumber</a></td>

                                        @*<td class="text-center">@vehicle.ListAmount.ToString("C", nfi)</td>*@

                                        @*<td class="text-center"><a href="@titleLink" target="blank">@status</a></td>*@
                                        <td class="text-center">
                                            <a class="status5editInfo" data-vin="@vehicle.VIN" data-stock="@vehicle.StockNumber"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a><br />
                                            @if (Notes != null && Notes != "")
                                            {
                                                <a href="#" data-toggle="tooltip" title="@Notes">
                                                    <i class="fa fa-comments-o" aria-hidden="true"></i>
                                                </a>
                                            }
                                        </td>

                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Totals</th>
                                <th class="text-center">@Status5TotalVehicles</th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center">@Status5TotalAmount.ToString("C", nfi)</th>
                                @*<th class="text-center"></th>
                                    <th class="text-center"></th>*@
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-right" colspan="3">
                                    ClearTitle<br />
                                    Title Due Bank<br />
                                    Title Due Customer<br />
                                    Title Due Interco<br />
                                    Title Due Auction<br />
                                    Lien Due Bank<br />
                                    Lien Due Customer<br />
                                    Odom Due Customer<br />
                                    POA Due Customer<br />
                                    Payoff Due Customer<br />
                                    Out of State Title<br />
                                    Duplicate Title<br />
                                    No Title Dispose<br />
                                    E-Title<br />
                                    Other<br />
                                    No Status<br />
                                </th>
                                <th class="text-center">
                                    @TotalClearTitle<br />
                                    @TotalTitleBank<br />
                                    @TotalTitleCustomer<br />
                                    @TotalTitleInterco<br />
                                    @TotalTitleAuction<br />
                                    @TotalLienBank<br />
                                    @TotalLienCustomer<br />
                                    @TotalOdomCustomer<br />
                                    @TotalPOACustomer<br />
                                    @TotalPayoffCustomer<br />
                                    @TotalOutStateTitle<br />
                                    @TotalDupTitle<br />
                                    @TotalNoTitleDispose<br />
                                    @TotalETitle<br />
                                    @TotalOther<br />
                                    @TotalNoStatus<br />
                                </th>
                            </tr>
                        </tfoot>
                    </table>

                    <script type="text/javascript">
                        $(document).ready(function () {
                            $('#status5-vehicles').DataTable({
                                searching: true,
                                dom: 'Bfrtip',
                                pageLength: -1,
                                buttons: [
                                    {
                                        extend: 'copyHtml5', footer: true,
                                    },
                                    {
                                        extend: 'excelHtml5', footer: true,
                                    },
                                    {
                                        extend: 'pdfHtml5', footer: true,
                                        orientation: 'landscape'
                                    },
                                    {
                                        extend: 'print', footer: true,
                                        orientation: 'landscape'
                                    }
                                ],
                                columnDefs: [
                                  { type: 'any-number', targets: [ 7, 8, 9, 10] },
                                  { type: 'date', targets: [12]},
                                ]

                            });
                        });
                        $(document).ready(function () {

                            $('[data-toggle="tooltip"]').tooltip();

                            var dialogWidth = 0;

                            dialogWidth = ($(window).width() * .75);

                            if ($(window).width() > 1199) {
                                dialogWidth = 1200;
                            }

                            $('body').on('click', '.status5editInfo', function (event) {
                                var vin = $(this).attr("data-vin");

                                var url = "@applicationPath/Home/VehicleNotes/?status=5&vin=" + vin;
                                var dialogBox = $("<div>");

                                $(dialogBox).dialog({
                                    resizable: false,
                                    height: "auto",
                                    width: dialogWidth,
                                    position: { my: "center", at: "top+25%", of: window },
                                    title: 'Update Vehicle Notes',
                                    modal: true,
                                    open: function (event, ui) {
                                        $(this).load(url);
                                        //$('#BonusDraws').validate();
                                    },
                                    buttons: {
                                        "Save": function () {
                                            var $this = this;
                                            var form = $('#UpdateVehicleNotes', $this);
                                            //if (!$(form).valid()) {
                                            //    return false;
                                            //}

                                            $.ajax({
                                                async: false,
                                                type: 'POST',
                                                url: form.attr("action"),
                                                data: $(form).serialize(),
                                                success: $($this).dialog("close").dialog("destroy").remove()
                                            });

                                            //location.reload();
                                        },

                                        "Close": function () {
                                            $(this).dialog("close");
                                            $(this).empty();
                                        }
                                    }
                                });
                                $(dialogBox).dialog('open');
                            });
                        });
                    </script>

                </div>

                <div class="tab-pane fade" id="status21" role="tabpanel" aria-labelledby="status21-tab">
                    <h3>Status 21 Vehicles</h3>

                    @{
                        decimal Status21TotalVehicles = 0;
                        decimal Status21TotalAmount = 0;
                    }
                    <table class="table table-responsive table-bordered table-striped" id="status21-vehicles" style="font-size:11px;">
                        <thead>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Loc</th>
                                <th class="text-center">Stock #</th>
                                <th class="text-center">Year</th>
                                <th class="text-center">Make</th>
                                <th class="text-center">Model</th>
                                <th class="text-center">VIN</th>
                                <th class="text-center">Exterior Color</th>
                                <th class="text-center">Mileage</th>
                                <th class="text-center">Cost Amount</th>
                                <th class="text-center">Days in Inventory</th>
                                <th class="text-center">Days at Status</th>
                                @*<th class="text-center">List Amount</th>*@
                                <th class="text-center">Title Status</th>
                                <th class="text-center">Notes</th>

                            </tr>
                        </thead>

                        <tbody>
                            @{

                                var status21Vehicles = Model.OtherStatusVehicles.FindAll(x => x.Status == 21);

                                TotalClearTitle = 0;
                                TotalTitleBank = 0;
                                TotalTitleCustomer = 0;
                                TotalTitleInterco = 0;
                                TotalTitleAuction = 0;
                                TotalLienBank = 0;
                                TotalLienCustomer = 0;
                                TotalOdomCustomer = 0;
                                TotalPOACustomer = 0;
                                TotalPayoffCustomer = 0;
                                TotalOutStateTitle = 0;
                                TotalDupTitle = 0;
                                TotalOther = 0;
                                TotalNoStatus = 0;

                                TotalNoTitleDispose = 0;
                                TotalETitle = 0;

                                foreach (var vehicle in status21Vehicles)
                                {
                                    var titleDue = titleStatus.Find(x => x.VIN == vehicle.VIN);

                                    var ManagerNoStatus = true;
                                    var status = "";

                                    if (titleDue != null)
                                    {
                                        if (titleDue.ClearTitle)
                                        {
                                            status += "Clear Title, ";
                                            TotalClearTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueBank)
                                        {
                                            status += "Title Bank, ";
                                            TotalTitleBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueCustomer)
                                        {
                                            status += "Title Customer, ";
                                            TotalTitleCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueInterco)
                                        {
                                            status += "Title Interco, ";
                                            TotalTitleInterco += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueAuction)
                                        {
                                            status += "Title Auction, ";
                                            TotalTitleAuction += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.LienDueBank)
                                        {
                                            status += "Lien Bank, ";
                                            TotalLienBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.LienDueCustomer)
                                        {
                                            status += "Lien Customer, ";
                                            TotalLienCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.OdomDueCustomer)
                                        {
                                            status += "Odom Customer, ";
                                            TotalOdomCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.POADueCust)
                                        {
                                            status += "POA Due, ";
                                            TotalPOACustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.PayoffDueCust)
                                        {
                                            status += "Payoff Due, ";
                                            TotalPayoffCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.WaitingOutSTTitle)
                                        {
                                            status += "Waiting Out, ";
                                            TotalOutStateTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.DuplicateTitleAppliedFor)
                                        {
                                            status += "Dup Title, ";
                                            TotalDupTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.Other)
                                        {
                                            status += "Other, ";
                                            TotalOther += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.NoTitleDispose)
                                        {
                                            status += "No Title Dispose, ";
                                            TotalNoTitleDispose += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.ElectronicTitle)
                                        {
                                            status += "E-Title, ";
                                            TotalETitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                    }

                                    if (ManagerNoStatus)
                                    {
                                        status = "No Status";
                                        TotalNoStatus += 1;
                                    }
                                    status = status.TrimEnd(' ').TrimEnd(',');

                                    Status21TotalVehicles += 1;
                                    Status21TotalAmount += vehicle.CostAmount;

                                    var titleLink = "http://jjfserver/SalesCommission/Reports/UpdateTitleDue?vin=" + vehicle.VIN;
                                    if (ManagerNoStatus)
                                    {
                                        titleLink = "http://jjfserver/SalesCommission/Reports/AddTitleDue?vin=" + vehicle.VIN;
                                    }

                                    var invHistory = Model.InventoryStatusHistory.FindAll(x => x.stk.Trim() == vehicle.StockNumber.Trim()).OrderByDescending(x => x.UCHISTID);
                                    var statusChangeDate = new DateTime();

                                    foreach (var hist in invHistory)
                                    {
                                        if (hist.status != vehicle.Status)
                                        {
                                            statusChangeDate = hist.updated;
                                            break;
                                        }
                                    }

                                    Int32 invStatusDays = 0;
                                    if (statusChangeDate == new DateTime())
                                    {
                                        invStatusDays = vehicle.DaysInventory;
                                    }
                                    else
                                    {
                                        invStatusDays = (Int32)(DateTime.Now - statusChangeDate).TotalDays;
                                    }

                                    var vehicleNotes = Model.AllVehicleNotes.Find(x => x.VIN == vehicle.VIN && x.InventoryStatus == 21);
                                    var Notes = "";

                                    if (vehicleNotes != null)
                                    {
                                        Notes = vehicleNotes.Notes;
                                    }

                                    <tr>
                                        <td class="text-center">@vehicle.Location</td>
                                        <td class="text-center">@vehicle.StockNumber</td>
                                        <td class="text-center">@vehicle.ModelYear</td>
                                        <td class="text-center">@vehicle.Make</td>
                                        <td class="text-center">@vehicle.Model</td>
                                        <td class="text-center">@vehicle.VIN</td>
                                        <td class="text-center">@vehicle.Color</td>
                                        <td class="text-center">@vehicle.Miles</td>
                                        <td class="text-center">@vehicle.CostAmount.ToString("C", nfi)</td>
                                        <td class="text-center">@vehicle.DaysInventory</td>
                                        <td class="text-center">@invStatusDays</td>
                                        @*<td class="text-center">@vehicle.ListAmount.ToString("C", nfi)</td>*@
                                        <td class="text-center"><a href="@titleLink" target="blank">@status</a></td>
                                        <td class="text-center">
                                            <a class="status21editInfo" data-vin="@vehicle.VIN" data-stock="@vehicle.StockNumber"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a><br />
                                            @if (Notes != null && Notes != "")
                                            {
                                                <a href="#" data-toggle="tooltip" title="@Notes">
                                                    <i class="fa fa-comments-o" aria-hidden="true"></i>
                                                </a>
                                            }
                                        </td>

                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Totals</th>
                                <th class="text-center">@Status21TotalVehicles</th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center">@Status21TotalAmount.ToString("C", nfi)</th>
                                @*<th class="text-center"></th>*@

                                <th class="text-right" colspan="3">
                                    ClearTitle<br />
                                    Title Due Bank<br />
                                    Title Due Customer<br />
                                    Title Due Interco<br />
                                    Title Due Auction<br />
                                    Lien Due Bank<br />
                                    Lien Due Customer<br />
                                    Odom Due Customer<br />
                                    POA Due Customer<br />
                                    Payoff Due Customer<br />
                                    Out of State Title<br />
                                    Duplicate Title<br />
                                    No Title Dispose<br />
                                    E-Title<br />
                                    Other<br />
                                    No Status<br />
                                </th>
                                <th class="text-center">
                                    @TotalClearTitle<br />
                                    @TotalTitleBank<br />
                                    @TotalTitleCustomer<br />
                                    @TotalTitleInterco<br />
                                    @TotalTitleAuction<br />
                                    @TotalLienBank<br />
                                    @TotalLienCustomer<br />
                                    @TotalOdomCustomer<br />
                                    @TotalPOACustomer<br />
                                    @TotalPayoffCustomer<br />
                                    @TotalOutStateTitle<br />
                                    @TotalDupTitle<br />
                                    @TotalNoTitleDispose<br />
                                    @TotalETitle<br />
                                    @TotalOther<br />
                                    @TotalNoStatus<br />
                                </th>
                            </tr>
                        </tfoot>
                    </table>

                    <script type="text/javascript">
                        $(document).ready(function () {
                            $('#status21-vehicles').DataTable({
                                searching: true,
                                dom: 'Bfrtip',
                                pageLength: -1,
                                buttons: [
                                    {
                                        extend: 'copyHtml5', footer: true,
                                    },
                                    {
                                        extend: 'excelHtml5', footer: true,
                                    },
                                    {
                                        extend: 'pdfHtml5', footer: true,
                                        orientation: 'landscape'
                                    },
                                    {
                                        extend: 'print', footer: true,
                                        orientation: 'landscape'
                                    }
                                ],
                                columnDefs: [
                                  { type: 'any-number', targets: [ 7, 8, 9, 10] },

                                ]

                            });
                        });
                        $(document).ready(function () {

                            $('[data-toggle="tooltip"]').tooltip();

                            var dialogWidth = 0;

                            dialogWidth = ($(window).width() * .75);

                            if ($(window).width() > 1199) {
                                dialogWidth = 1200;
                            }

                            $('body').on('click', '.status21editInfo', function (event) {
                                var vin = $(this).attr("data-vin");

                                var url = "@applicationPath/Home/VehicleNotes/?status=21&vin=" + vin;
                                var dialogBox = $("<div>");

                                $(dialogBox).dialog({
                                    resizable: false,
                                    height: "auto",
                                    width: dialogWidth,
                                    position: { my: "center", at: "top+25%", of: window },
                                    title: 'Update Vehicle Notes',
                                    modal: true,
                                    open: function (event, ui) {
                                        $(this).load(url);
                                        //$('#BonusDraws').validate();
                                    },
                                    buttons: {
                                        "Save": function () {
                                            var $this = this;
                                            var form = $('#UpdateVehicleNotes', $this);
                                            //if (!$(form).valid()) {
                                            //    return false;
                                            //}

                                            $.ajax({
                                                async: false,
                                                type: 'POST',
                                                url: form.attr("action"),
                                                data: $(form).serialize(),
                                                success: $($this).dialog("close").dialog("destroy").remove()
                                            });

                                            //location.reload();
                                        },

                                        "Close": function () {
                                            $(this).dialog("close");
                                            $(this).empty();
                                        }
                                    }
                                });
                                $(dialogBox).dialog('open');
                            });
                        });
                    </script>

                </div>

                <div class="tab-pane fade" id="status14" role="tabpanel" aria-labelledby="status14-tab">
                    <h3>Status 14 Vehicles</h3>

                    @{
                        decimal Status14TotalVehicles = 0;
                        decimal Status14TotalAmount = 0;
                    }
                    <table class="table table-responsive table-bordered table-striped" id="status21-vehicles" style="font-size:11px;">
                        <thead>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Loc</th>
                                <th class="text-center">Stock #</th>
                                <th class="text-center">Year</th>
                                <th class="text-center">Make</th>
                                <th class="text-center">Model</th>
                                <th class="text-center">VIN</th>
                                <th class="text-center">Exterior Color</th>
                                <th class="text-center">Mileage</th>
                                <th class="text-center">Cost Amount</th>
                                <th class="text-center">Days in Inventory</th>
                                <th class="text-center">Days at Status</th>
                                @*<th class="text-center">List Amount</th>*@
                                <th class="text-center">Title Status</th>
                                <th class="text-center">Notes</th>

                            </tr>
                        </thead>

                        <tbody>
                            @{

                                var status14Vehicles = Model.OtherStatusVehicles.FindAll(x => x.Status == 14);

                                TotalClearTitle = 0;
                                TotalTitleBank = 0;
                                TotalTitleCustomer = 0;
                                TotalTitleInterco = 0;
                                TotalTitleAuction = 0;
                                TotalLienBank = 0;
                                TotalLienCustomer = 0;
                                TotalOdomCustomer = 0;
                                TotalPOACustomer = 0;
                                TotalPayoffCustomer = 0;
                                TotalOutStateTitle = 0;
                                TotalDupTitle = 0;
                                TotalOther = 0;
                                TotalNoStatus = 0;

                                TotalNoTitleDispose = 0;
                                TotalETitle = 0;

                                foreach (var vehicle in status14Vehicles)
                                {
                                    var titleDue = titleStatus.Find(x => x.VIN == vehicle.VIN);

                                    var ManagerNoStatus = true;
                                    var status = "";

                                    if (titleDue != null)
                                    {
                                        if (titleDue.ClearTitle)
                                        {
                                            status += "Clear Title, ";
                                            TotalClearTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueBank)
                                        {
                                            status += "Title Bank, ";
                                            TotalTitleBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueCustomer)
                                        {
                                            status += "Title Customer, ";
                                            TotalTitleCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueInterco)
                                        {
                                            status += "Title Interco, ";
                                            TotalTitleInterco += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueAuction)
                                        {
                                            status += "Title Auction, ";
                                            TotalTitleAuction += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.LienDueBank)
                                        {
                                            status += "Lien Bank, ";
                                            TotalLienBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.LienDueCustomer)
                                        {
                                            status += "Lien Customer, ";
                                            TotalLienCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.OdomDueCustomer)
                                        {
                                            status += "Odom Customer, ";
                                            TotalOdomCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.POADueCust)
                                        {
                                            status += "POA Due, ";
                                            TotalPOACustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.PayoffDueCust)
                                        {
                                            status += "Payoff Due, ";
                                            TotalPayoffCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.WaitingOutSTTitle)
                                        {
                                            status += "Waiting Out, ";
                                            TotalOutStateTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.DuplicateTitleAppliedFor)
                                        {
                                            status += "Dup Title, ";
                                            TotalDupTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.Other)
                                        {
                                            status += "Other, ";
                                            TotalOther += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.NoTitleDispose)
                                        {
                                            status += "No Title Dispose, ";
                                            TotalNoTitleDispose += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.ElectronicTitle)
                                        {
                                            status += "E-Title, ";
                                            TotalETitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                    }

                                    if (ManagerNoStatus)
                                    {
                                        status = "No Status";
                                        TotalNoStatus += 1;
                                    }
                                    status = status.TrimEnd(' ').TrimEnd(',');

                                    Status14TotalVehicles += 1;
                                    Status14TotalAmount += vehicle.CostAmount;

                                    var titleLink = "http://jjfserver/SalesCommission/Reports/UpdateTitleDue?vin=" + vehicle.VIN;
                                    if (ManagerNoStatus)
                                    {
                                        titleLink = "http://jjfserver/SalesCommission/Reports/AddTitleDue?vin=" + vehicle.VIN;
                                    }

                                    var invHistory = Model.InventoryStatusHistory.FindAll(x => x.stk.Trim() == vehicle.StockNumber.Trim()).OrderByDescending(x => x.UCHISTID);
                                    var statusChangeDate = new DateTime();

                                    foreach (var hist in invHistory)
                                    {
                                        if (hist.status != vehicle.Status)
                                        {
                                            statusChangeDate = hist.updated;
                                            break;
                                        }
                                    }

                                    Int32 invStatusDays = 0;
                                    if (statusChangeDate == new DateTime())
                                    {
                                        invStatusDays = 0;// vehicle.DaysInventory;
                                    }
                                    else
                                    {
                                        invStatusDays = (Int32)(DateTime.Now - statusChangeDate).TotalDays;
                                    }

                                    var vehicleNotes = Model.AllVehicleNotes.Find(x => x.VIN == vehicle.VIN && x.InventoryStatus == 14);
                                    var Notes = "";

                                    if (vehicleNotes != null)
                                    {
                                        Notes = vehicleNotes.Notes;
                                    }

                                    <tr>
                                        <td class="text-center">@vehicle.Location</td>
                                        <td class="text-center">@vehicle.StockNumber</td>
                                        <td class="text-center">@vehicle.ModelYear</td>
                                        <td class="text-center">@vehicle.Make</td>
                                        <td class="text-center">@vehicle.Model</td>
                                        <td class="text-center">@vehicle.VIN</td>
                                        <td class="text-center">@vehicle.Color</td>
                                        <td class="text-center">@vehicle.Miles</td>
                                        <td class="text-center">@vehicle.CostAmount.ToString("C", nfi)</td>
                                        <td class="text-center">@vehicle.DaysInventory</td>
                                        <td class="text-center">@invStatusDays</td>
                                        @*<td class="text-center">@vehicle.ListAmount.ToString("C", nfi)</td>*@
                                        <td class="text-center"><a href="@titleLink" target="blank">@status</a></td>
                                        <td class="text-center">
                                            <a class="status21editInfo" data-vin="@vehicle.VIN" data-stock="@vehicle.StockNumber"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a><br />
                                            @if (Notes != null && Notes != "")
                                            {
                                                <a href="#" data-toggle="tooltip" title="@Notes">
                                                    <i class="fa fa-comments-o" aria-hidden="true"></i>
                                                </a>
                                            }
                                        </td>

                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Totals</th>
                                <th class="text-center">@Status14TotalVehicles</th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center">@Status14TotalAmount.ToString("C", nfi)</th>
                                @*<th class="text-center"></th>*@

                                <th class="text-right" colspan="3">
                                    ClearTitle<br />
                                    Title Due Bank<br />
                                    Title Due Customer<br />
                                    Title Due Interco<br />
                                    Title Due Auction<br />
                                    Lien Due Bank<br />
                                    Lien Due Customer<br />
                                    Odom Due Customer<br />
                                    POA Due Customer<br />
                                    Payoff Due Customer<br />
                                    Out of State Title<br />
                                    Duplicate Title<br />
                                    No Title Dispose<br />
                                    E-Title<br />
                                    Other<br />
                                    No Status<br />
                                </th>
                                <th class="text-center">
                                    @TotalClearTitle<br />
                                    @TotalTitleBank<br />
                                    @TotalTitleCustomer<br />
                                    @TotalTitleInterco<br />
                                    @TotalTitleAuction<br />
                                    @TotalLienBank<br />
                                    @TotalLienCustomer<br />
                                    @TotalOdomCustomer<br />
                                    @TotalPOACustomer<br />
                                    @TotalPayoffCustomer<br />
                                    @TotalOutStateTitle<br />
                                    @TotalDupTitle<br />
                                    @TotalNoTitleDispose<br />
                                    @TotalETitle<br />
                                    @TotalOther<br />
                                    @TotalNoStatus<br />
                                </th>
                            </tr>
                        </tfoot>
                    </table>

                    <script type="text/javascript">
                        $(document).ready(function () {
                            $('#status14-vehicles').DataTable({
                                searching: true,
                                dom: 'Bfrtip',
                                pageLength: -1,
                                buttons: [
                                    {
                                        extend: 'copyHtml5', footer: true,
                                    },
                                    {
                                        extend: 'excelHtml5', footer: true,
                                    },
                                    {
                                        extend: 'pdfHtml5', footer: true,
                                        orientation: 'landscape'
                                    },
                                    {
                                        extend: 'print', footer: true,
                                        orientation: 'landscape'
                                    }
                                ],
                                columnDefs: [
                                  { type: 'any-number', targets: [ 7, 8, 9, 10] },

                                ]

                            });
                        });
                        $(document).ready(function () {

                            $('[data-toggle="tooltip"]').tooltip();

                            var dialogWidth = 0;

                            dialogWidth = ($(window).width() * .75);

                            if ($(window).width() > 1199) {
                                dialogWidth = 1200;
                            }

                            $('body').on('click', '.status14editInfo', function (event) {
                                var vin = $(this).attr("data-vin");

                                var url = "@applicationPath/Home/VehicleNotes/?status=21&vin=" + vin;
                                var dialogBox = $("<div>");

                                $(dialogBox).dialog({
                                    resizable: false,
                                    height: "auto",
                                    width: dialogWidth,
                                    position: { my: "center", at: "top+25%", of: window },
                                    title: 'Update Vehicle Notes',
                                    modal: true,
                                    open: function (event, ui) {
                                        $(this).load(url);
                                        //$('#BonusDraws').validate();
                                    },
                                    buttons: {
                                        "Save": function () {
                                            var $this = this;
                                            var form = $('#UpdateVehicleNotes', $this);
                                            //if (!$(form).valid()) {
                                            //    return false;
                                            //}

                                            $.ajax({
                                                async: false,
                                                type: 'POST',
                                                url: form.attr("action"),
                                                data: $(form).serialize(),
                                                success: $($this).dialog("close").dialog("destroy").remove()
                                            });

                                            //location.reload();
                                        },

                                        "Close": function () {
                                            $(this).dialog("close");
                                            $(this).empty();
                                        }
                                    }
                                });
                                $(dialogBox).dialog('open');
                            });
                        });
                    </script>

                </div>

                <div class="tab-pane fade" id="status15" role="tabpanel" aria-labelledby="status15-tab">
                    <h3>Status 15 Vehicles</h3>

                    @{
                        decimal Status15TotalVehicles = 0;
                        decimal Status15TotalAmount = 0;
                    }
                    <table class="table table-responsive table-bordered table-striped" id="status15-vehicles" style="font-size:11px;">
                        <thead>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Loc</th>
                                <th class="text-center">Stock #</th>
                                <th class="text-center">Year</th>
                                <th class="text-center">Make</th>
                                <th class="text-center">Model</th>
                                <th class="text-center">VIN</th>
                                <th class="text-center">Exterior Color</th>
                                <th class="text-center">In Service Miles</th>
                                <th class="text-center">Days in Inventory</th>
                                <th class="text-center">Days at Status</th>
                                @*<th class="text-center">List Amount</th>*@
                                <th class="text-center">Acct Inv Amount</th>
                                <th class="text-center">Title Status</th>
                                <th class="text-center">Memo 1</th>
                                <th class="text-center">Memo 2</th>
                                <th class="text-center">Last Service Date</th>
                                <th class="text-center">Last RO Miles</th>
                                <th class="text-center">Recall Status</th>\
                                <th class="text-center">Notes</th>

                            </tr>
                        </thead>

                        <tbody>
                            @{

                                var status15Vehicles = Model.OtherStatusVehicles.FindAll(x => x.Status == 15);

                                TotalClearTitle = 0;
                                TotalTitleBank = 0;
                                TotalTitleCustomer = 0;
                                TotalTitleInterco = 0;
                                TotalTitleAuction = 0;
                                TotalLienBank = 0;
                                TotalLienCustomer = 0;
                                TotalOdomCustomer = 0;
                                TotalPOACustomer = 0;
                                TotalPayoffCustomer = 0;
                                TotalOutStateTitle = 0;
                                TotalDupTitle = 0;
                                TotalOther = 0;
                                TotalNoStatus = 0;

                                TotalNoTitleDispose = 0;
                                TotalETitle = 0;

                                foreach (var vehicle in status15Vehicles)
                                {
                                    var titleDue = titleStatus.Find(x => x.VIN == vehicle.VIN);

                                    var ManagerNoStatus = true;
                                    var status = "";

                                    if (titleDue != null)
                                    {
                                        if (titleDue.ClearTitle)
                                        {
                                            status += "Clear Title, ";
                                            TotalClearTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueBank)
                                        {
                                            status += "Title Bank, ";
                                            TotalTitleBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueCustomer)
                                        {
                                            status += "Title Customer, ";
                                            TotalTitleCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueInterco)
                                        {
                                            status += "Title Interco, ";
                                            TotalTitleInterco += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueAuction)
                                        {
                                            status += "Title Auction, ";
                                            TotalTitleAuction += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.LienDueBank)
                                        {
                                            status += "Lien Bank, ";
                                            TotalLienBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.LienDueCustomer)
                                        {
                                            status += "Lien Customer, ";
                                            TotalLienCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.OdomDueCustomer)
                                        {
                                            status += "Odom Customer, ";
                                            TotalOdomCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.POADueCust)
                                        {
                                            status += "POA Due, ";
                                            TotalPOACustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.PayoffDueCust)
                                        {
                                            status += "Payoff Due, ";
                                            TotalPayoffCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.WaitingOutSTTitle)
                                        {
                                            status += "Waiting Out, ";
                                            TotalOutStateTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.DuplicateTitleAppliedFor)
                                        {
                                            status += "Dup Title, ";
                                            TotalDupTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.Other)
                                        {
                                            status += "Other, ";
                                            TotalOther += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.NoTitleDispose)
                                        {
                                            status += "No Title Dispose, ";
                                            TotalNoTitleDispose += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.ElectronicTitle)
                                        {
                                            status += "E-Title, ";
                                            TotalETitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                    }

                                    if (ManagerNoStatus)
                                    {
                                        status = "No Status";
                                        TotalNoStatus += 1;
                                    }
                                    status = status.TrimEnd(' ').TrimEnd(',');

                                    Status15TotalVehicles += 1;
                                    Status15TotalAmount += vehicle.CostAmount;

                                    var titleLink = "http://jjfserver/SalesCommission/Reports/UpdateTitleDue?vin=" + vehicle.VIN;
                                    if (ManagerNoStatus)
                                    {
                                        titleLink = "http://jjfserver/SalesCommission/Reports/AddTitleDue?vin=" + vehicle.VIN;
                                    }

                                    var invHistory = Model.InventoryStatusHistory.FindAll(x => x.stk.Trim() == vehicle.StockNumber.Trim()).OrderByDescending(x => x.UCHISTID);
                                    var statusChangeDate = new DateTime();

                                    foreach (var hist in invHistory)
                                    {
                                        if (hist.status != vehicle.Status)
                                        {
                                            statusChangeDate = hist.updated;
                                            break;
                                        }
                                    }

                                    Int32 invStatusDays = 0;
                                    if (statusChangeDate == new DateTime())
                                    {
                                        invStatusDays = vehicle.DaysInventory;
                                    }
                                    else
                                    {
                                        invStatusDays = (Int32)(DateTime.Now - statusChangeDate).TotalDays;
                                    }

                                    var vehicleNotes = Model.AllVehicleNotes.Find(x => x.VIN == vehicle.VIN && x.InventoryStatus == 15);
                                    var Notes = "";

                                    if (vehicleNotes != null)
                                    {
                                        Notes = vehicleNotes.Notes;
                                    }


                                    var recalls = Model.AllOpenRecalls.FindAll(x => x.StockNo.Trim() == vehicle.StockNumber.Trim() && x.VIN.Trim() == vehicle.VIN.Trim());

                                    var recallNotes = "";
                                    foreach (var recall in recalls)
                                    {
                                        recallNotes += recall.Description + ", ";
                                    }
                                    recallNotes = recallNotes.TrimEnd(' ').TrimEnd(',');

                                    <tr>
                                        <td class="text-center">@vehicle.Location</td>
                                        <td class="text-center">@vehicle.StockNumber</td>
                                        <td class="text-center">@vehicle.ModelYear</td>
                                        <td class="text-center">@vehicle.Make</td>
                                        <td class="text-center">@vehicle.Model</td>
                                        <td class="text-center">@vehicle.VIN</td>
                                        <td class="text-center">@vehicle.Color</td>
                                        <td class="text-center">@vehicle.Miles</td>
                                        <td class="text-center">@vehicle.DaysInventory</td>
                                        <td class="text-center">@invStatusDays</td>
                                        @*<td class="text-center">@vehicle.ListAmount.ToString("C", nfi)</td>*@
                                        <td class="text-center">@vehicle.CostAmount.ToString("C", nfi)</td>
                                        <td class="text-center"><a href="@titleLink" target="blank">@status</a></td>
                                        <td class="text-center">@vehicle.Memo1</td>
                                        <td class="text-center">@vehicle.Memo2</td>


                                        <td class="text-center">
                                            @if (vehicle.RODate.ToShortDateString() != "1/1/0001" && vehicle.RODate.ToShortDateString() != "1/1/1900")
                                            {
                                                @:@vehicle.RODate.ToShortDateString()
                                        }
                                        </td>
                                        <td class="text-center">@vehicle.ROMiles</td>
                                        <td class="text-center">

                                            <a href="#" data-toggle="tooltip" title="@recallNotes">
                                                @recalls.Count
                                            </a>
                                        </td>
                                        <td class="text-center">
                                            <a class="status15editInfo" data-vin="@vehicle.VIN" data-stock="@vehicle.StockNumber"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a><br />
                                            @if (Notes != null && Notes != "")
                                            {
                                                <a href="#" data-toggle="tooltip" title="@Notes">
                                                    <i class="fa fa-comments-o" aria-hidden="true"></i>
                                                </a>
                                            }
                                        </td>

                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Totals</th>
                                <th class="text-center">@Status15TotalVehicles</th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center">@Status15TotalAmount.ToString("C", nfi)</th>
                                @*<th class="text-center"></th>*@
                                <th class="text-center"></th>
                                <th class="text-center"></th>

                                <th class="text-center"></th>

                                <th class="text-right" colspan="3">
                                    ClearTitle<br />
                                    Title Due Bank<br />
                                    Title Due Customer<br />
                                    Title Due Interco<br />
                                    Title Due Auction<br />
                                    Lien Due Bank<br />
                                    Lien Due Customer<br />
                                    Odom Due Customer<br />
                                    POA Due Customer<br />
                                    Payoff Due Customer<br />
                                    Out of State Title<br />
                                    Duplicate Title<br />
                                    No Title Dispose<br />
                                    E-Title<br />
                                    Other<br />
                                    No Status<br />
                                </th>
                                <th class="text-center">
                                    @TotalClearTitle<br />
                                    @TotalTitleBank<br />
                                    @TotalTitleCustomer<br />
                                    @TotalTitleInterco<br />
                                    @TotalTitleAuction<br />
                                    @TotalLienBank<br />
                                    @TotalLienCustomer<br />
                                    @TotalOdomCustomer<br />
                                    @TotalPOACustomer<br />
                                    @TotalPayoffCustomer<br />
                                    @TotalOutStateTitle<br />
                                    @TotalDupTitle<br />
                                    @TotalNoTitleDispose<br />
                                    @TotalETitle<br />
                                    @TotalOther<br />
                                    @TotalNoStatus<br />
                                </th>
                            </tr>
                        </tfoot>
                    </table>

                    <script type="text/javascript">
                        $(document).ready(function () {
                            $('#status15-vehicles').DataTable({
                                searching: true,
                                dom: 'Bfrtip',
                                pageLength: -1,
                                buttons: [
                                    {
                                        extend: 'copyHtml5', footer: true,
                                    },
                                    {
                                        extend: 'excelHtml5', footer: true,
                                    },
                                    {
                                        extend: 'pdfHtml5', footer: true,
                                        orientation: 'landscape'
                                    },
                                    {
                                        extend: 'print', footer: true,
                                        orientation: 'landscape'
                                    }
                                ],
                                columnDefs: [
                                  { type: 'any-number', targets: [ 7, 8, 9, 10] },
                                  { type: 'date', targets: [12]}
                                ]

                            });
                        });
                        $(document).ready(function () {

                            $('[data-toggle="tooltip"]').tooltip();

                            var dialogWidth = 0;

                            dialogWidth = ($(window).width() * .75);

                            if ($(window).width() > 1199) {
                                dialogWidth = 1200;
                            }

                            $('body').on('click', '.status15editInfo', function (event) {
                                var vin = $(this).attr("data-vin");

                                var url = "@applicationPath/Home/VehicleNotes/?status=21&vin=" + vin;
                                var dialogBox = $("<div>");

                                $(dialogBox).dialog({
                                    resizable: false,
                                    height: "auto",
                                    width: dialogWidth,
                                    position: { my: "center", at: "top+25%", of: window },
                                    title: 'Update Vehicle Notes',
                                    modal: true,
                                    open: function (event, ui) {
                                        $(this).load(url);
                                        //$('#BonusDraws').validate();
                                    },
                                    buttons: {
                                        "Save": function () {
                                            var $this = this;
                                            var form = $('#UpdateVehicleNotes', $this);
                                            //if (!$(form).valid()) {
                                            //    return false;
                                            //}

                                            $.ajax({
                                                async: false,
                                                type: 'POST',
                                                url: form.attr("action"),
                                                data: $(form).serialize(),
                                                success: $($this).dialog("close").dialog("destroy").remove()
                                            });

                                            //location.reload();
                                        },

                                        "Close": function () {
                                            $(this).dialog("close");
                                            $(this).empty();
                                        }
                                    }
                                });
                                $(dialogBox).dialog('open');
                            });
                        });
                    </script>

                </div>
                <div class="tab-pane fade" id="status20" role="tabpanel" aria-labelledby="status20-tab">
                    <h3>Status 20 Vehicles</h3>

                    @{
                        decimal Status20TotalVehicles = 0;
                        decimal Status20TotalAmount = 0;
                    }
                    <table class="table table-responsive table-bordered table-striped" id="status20-vehicles" style="font-size:11px;">
                        <thead>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Loc</th>
                                <th class="text-center">Stock #</th>
                                <th class="text-center">Year</th>
                                <th class="text-center">Make</th>
                                <th class="text-center">Model</th>
                                <th class="text-center">VIN</th>
                                <th class="text-center">Exterior Color</th>
                                <th class="text-center">Mileage</th>
                                <th class="text-center">Cost Amount</th>
                                <th class="text-center">Days in Inventory</th>
                                <th class="text-center">Days at Status</th>
                                @*<th class="text-center">List Amount</th>*@
                                <th class="text-center">Title Status</th>
                                <th class="text-center">Notes</th>

                            </tr>
                        </thead>

                        <tbody>
                            @{

                                var status20Vehicles = Model.OtherStatusVehicles.FindAll(x => x.Status == 20);
                                status20Vehicles.AddRange(Model.NewStatus20Vehicles);

                                TotalClearTitle = 0;
                                TotalTitleBank = 0;
                                TotalTitleCustomer = 0;
                                TotalTitleInterco = 0;
                                TotalTitleAuction = 0;
                                TotalLienBank = 0;
                                TotalLienCustomer = 0;
                                TotalOdomCustomer = 0;
                                TotalPOACustomer = 0;
                                TotalPayoffCustomer = 0;
                                TotalOutStateTitle = 0;
                                TotalDupTitle = 0;
                                TotalOther = 0;
                                TotalNoStatus = 0;

                                TotalNoTitleDispose = 0;
                                TotalETitle = 0;

                                foreach (var vehicle in status20Vehicles)
                                {
                                    var titleDue = titleStatus.Find(x => x.VIN == vehicle.VIN);

                                    var ManagerNoStatus = true;
                                    var status = "";

                                    if (titleDue != null)
                                    {
                                        if (titleDue.ClearTitle)
                                        {
                                            status += "Clear Title, ";
                                            TotalClearTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueBank)
                                        {
                                            status += "Title Bank, ";
                                            TotalTitleBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueCustomer)
                                        {
                                            status += "Title Customer, ";
                                            TotalTitleCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueInterco)
                                        {
                                            status += "Title Interco, ";
                                            TotalTitleInterco += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.TitleDueAuction)
                                        {
                                            status += "Title Auction, ";
                                            TotalTitleAuction += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.LienDueBank)
                                        {
                                            status += "Lien Bank, ";
                                            TotalLienBank += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.LienDueCustomer)
                                        {
                                            status += "Lien Customer, ";
                                            TotalLienCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.OdomDueCustomer)
                                        {
                                            status += "Odom Customer, ";
                                            TotalOdomCustomer += 1;
                                            ManagerNoStatus = false;
                                        }

                                        if (titleDue.POADueCust)
                                        {
                                            status += "POA Due, ";
                                            TotalPOACustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.PayoffDueCust)
                                        {
                                            status += "Payoff Due, ";
                                            TotalPayoffCustomer += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.WaitingOutSTTitle)
                                        {
                                            status += "Waiting Out, ";
                                            TotalOutStateTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.DuplicateTitleAppliedFor)
                                        {
                                            status += "Dup Title, ";
                                            TotalDupTitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.Other)
                                        {
                                            status += "Other, ";
                                            TotalOther += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.NoTitleDispose)
                                        {
                                            status += "No Title Dispose, ";
                                            TotalNoTitleDispose += 1;
                                            ManagerNoStatus = false;
                                        }
                                        if (titleDue.ElectronicTitle)
                                        {
                                            status += "E-Title, ";
                                            TotalETitle += 1;
                                            ManagerNoStatus = false;
                                        }
                                    }

                                    if (ManagerNoStatus)
                                    {
                                        status = "No Status";
                                        TotalNoStatus += 1;
                                    }
                                    status = status.TrimEnd(' ').TrimEnd(',');

                                    Status20TotalVehicles += 1;
                                    Status20TotalAmount += vehicle.CostAmount;

                                    var titleLink = "http://jjfserver/SalesCommission/Reports/UpdateTitleDue?vin=" + vehicle.VIN;
                                    if (ManagerNoStatus)
                                    {
                                        titleLink = "http://jjfserver/SalesCommission/Reports/AddTitleDue?vin=" + vehicle.VIN;
                                    }

                                    var invHistory = Model.InventoryStatusHistory.FindAll(x => x.stk.Trim() == vehicle.StockNumber.Trim()).OrderByDescending(x => x.UCHISTID);
                                    var statusChangeDate = new DateTime();

                                    foreach (var hist in invHistory)
                                    {
                                        if (hist.status != vehicle.Status)
                                        {
                                            statusChangeDate = hist.updated;
                                            break;
                                        }
                                    }

                                    Int32 invStatusDays = 0;
                                    if (statusChangeDate == new DateTime())
                                    {
                                        invStatusDays = vehicle.DaysInventory;
                                    }
                                    else
                                    {
                                        invStatusDays = (Int32)(DateTime.Now - statusChangeDate).TotalDays;
                                    }

                                    var vehicleNotes = Model.AllVehicleNotes.Find(x => x.VIN == vehicle.VIN && x.InventoryStatus == 20);
                                    var Notes = "";

                                    if (vehicleNotes != null)
                                    {
                                        Notes = vehicleNotes.Notes;
                                    }

                                    <tr>
                                        <td class="text-center">@vehicle.Location</td>
                                        <td class="text-center">@vehicle.StockNumber</td>
                                        <td class="text-center">@vehicle.ModelYear</td>
                                        <td class="text-center">@vehicle.Make</td>
                                        <td class="text-center">@vehicle.Model</td>
                                        <td class="text-center">@vehicle.VIN</td>
                                        <td class="text-center">@vehicle.Color</td>
                                        <td class="text-center">@vehicle.Miles</td>
                                        <td class="text-center">@vehicle.CostAmount.ToString("C", nfi)</td>
                                        <td class="text-center">@vehicle.DaysInventory</td>
                                        <td class="text-center">@invStatusDays</td>
                                        @*<td class="text-center">@vehicle.ListAmount.ToString("C", nfi)</td>*@
                                        <td class="text-center"><a href="@titleLink" target="blank">@status</a></td>
                                        <td class="text-center">
                                            <a class="status20editInfo" data-vin="@vehicle.VIN" data-stock="@vehicle.StockNumber"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</a><br />
                                            @if (Notes != null && Notes != "")
                                            {
                                                <a href="#" data-toggle="tooltip" title="@Notes">
                                                    <i class="fa fa-comments-o" aria-hidden="true"></i>
                                                </a>
                                            }
                                        </td>

                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr style="background-color:#d9edf7">
                                <th class="text-center">Totals</th>
                                <th class="text-center">@Status20TotalVehicles</th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center"></th>
                                <th class="text-center">@Status20TotalAmount.ToString("C", nfi)</th>
                                @*<th class="text-center"></th>*@

                                <th class="text-right" colspan="3">
                                    ClearTitle<br />
                                    Title Due Bank<br />
                                    Title Due Customer<br />
                                    Title Due Interco<br />
                                    Title Due Auction<br />
                                    Lien Due Bank<br />
                                    Lien Due Customer<br />
                                    Odom Due Customer<br />
                                    POA Due Customer<br />
                                    Payoff Due Customer<br />
                                    Out of State Title<br />
                                    Duplicate Title<br />
                                    No Title Dispose<br />
                                    E-Title<br />
                                    Other<br />
                                    No Status<br />
                                </th>
                                <th class="text-center">
                                    @TotalClearTitle<br />
                                    @TotalTitleBank<br />
                                    @TotalTitleCustomer<br />
                                    @TotalTitleInterco<br />
                                    @TotalTitleAuction<br />
                                    @TotalLienBank<br />
                                    @TotalLienCustomer<br />
                                    @TotalOdomCustomer<br />
                                    @TotalPOACustomer<br />
                                    @TotalPayoffCustomer<br />
                                    @TotalOutStateTitle<br />
                                    @TotalDupTitle<br />
                                    @TotalNoTitleDispose<br />
                                    @TotalETitle<br />
                                    @TotalOther<br />
                                    @TotalNoStatus<br />
                                </th>
                            </tr>
                        </tfoot>
                    </table>

                    <script type="text/javascript">
                        $(document).ready(function () {
                            $('#status20-vehicles').DataTable({
                                searching: true,
                                dom: 'Bfrtip',
                                pageLength: -1,
                                buttons: [
                                    {
                                        extend: 'copyHtml5', footer: true,
                                    },
                                    {
                                        extend: 'excelHtml5', footer: true,
                                    },
                                    {
                                        extend: 'pdfHtml5', footer: true,
                                        orientation: 'landscape'
                                    },
                                    {
                                        extend: 'print', footer: true,
                                        orientation: 'landscape'
                                    }
                                ],
                                columnDefs: [
                                  { type: 'any-number', targets: [ 7, 8, 9, 10] },
                                ]

                            });
                        });
                        $(document).ready(function () {

                            $('[data-toggle="tooltip"]').tooltip();

                            var dialogWidth = 0;

                            dialogWidth = ($(window).width() * .75);

                            if ($(window).width() > 1199) {
                                dialogWidth = 1200;
                            }

                            $('body').on('click', '.status20editInfo', function (event) {
                                var vin = $(this).attr("data-vin");

                                var url = "@applicationPath/Home/VehicleNotes/?status=21&vin=" + vin;
                                var dialogBox = $("<div>");

                                $(dialogBox).dialog({
                                    resizable: false,
                                    height: "auto",
                                    width: dialogWidth,
                                    position: { my: "center", at: "top+25%", of: window },
                                    title: 'Update Vehicle Notes',
                                    modal: true,
                                    open: function (event, ui) {
                                        $(this).load(url);
                                        //$('#BonusDraws').validate();
                                    },
                                    buttons: {
                                        "Save": function () {
                                            var $this = this;
                                            var form = $('#UpdateVehicleNotes', $this);
                                            //if (!$(form).valid()) {
                                            //    return false;
                                            //}

                                            $.ajax({
                                                async: false,
                                                type: 'POST',
                                                url: form.attr("action"),
                                                data: $(form).serialize(),
                                                success: $($this).dialog("close").dialog("destroy").remove()
                                            });

                                            //location.reload();
                                        },

                                        "Close": function () {
                                            $(this).dialog("close");
                                            $(this).empty();
                                        }
                                    }
                                });
                                $(dialogBox).dialog('open');
                            });
                        });
                    </script>

                </div>
                
            </div>
        </div>
    </div>



                            }
@section scripts
{
    <script type="text/javascript">
        $(document).ready(function () {
            $('#vehicleListing-summary').DataTable({
              searching: true,
              dom: 'Bfrtip',
              pageLength: -1,
              buttons: [
                  {
                      extend: 'copyHtml5', footer: true,
                  },
                  {
                      extend: 'excelHtml5', footer: true,
                  },
                  {
                      extend: 'pdfHtml5', footer: true,
                      orientation: 'landscape'
                  },
                  {
                      extend: 'print', footer: true,
                      orientation: 'landscape'
                  }
              ],
              columnDefs: [
                { type: 'any-number', targets: [4,5,6,7,8, 9, 10] },

              ]

            });
            $('#inventory-summary').DataTable({
                searching: true,
                dom: 'Bfrtip',
                pageLength: -1,
                buttons: [
                    {
                        extend: 'copyHtml5', footer: true,
                    },
                    {
                        extend: 'excelHtml5', footer: true,
                    },
                    {
                        extend: 'pdfHtml5', footer: true,
                        orientation: 'landscape'
                    },
                    {
                        extend: 'print', footer: true,
                        orientation: 'landscape'
                    }
                ],
                columnDefs: [
                  { type: 'any-number', targets: [1, 4, 6, 8, 10] },

                ]

            });
      });

    </script>

}